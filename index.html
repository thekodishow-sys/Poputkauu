<!DOCTYPE html>
<html lang="ru">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>ĞŸĞ¾Ğ¿ÑƒÑ‚ĞºĞ° 12</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;
Â  Â  Â  Â  Â  Â  overscroll-behavior-y: contain;
Â  Â  Â  Â  }
Â  Â  Â  Â  .screen { display: none; animation: fadeIn 0.3s ease-in-out; }
Â  Â  Â  Â  .screen.active { display: block; }
Â  Â  Â  Â  @keyframes fadeIn {
Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: translateY(5px); }
Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .role-btn.active, .direction-buttons button.active {
Â  Â  Â  Â  Â  Â  background-color: #1e293b; /* slate-800 */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  #time-interval-buttons button.active {
Â  Â  Â  Â  Â  Â  background-color: #1e293b; /* slate-800 */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-color: #1e293b;
Â  Â  Â  Â  }
Â  Â  Â  Â  #time-interval-buttons button.active .text-slate-500 {
Â  Â  Â  Â  Â  Â  color: #cbd5e1; /* slate-300 */
Â  Â  Â  Â  }
Â  Â  Â  Â  #role-switcher { position: relative; }
Â  Â  Â  Â  #role-bg {
Â  Â  Â  Â  Â  Â  position: absolute; width: 36px; height: 36px;
Â  Â  Â  Â  Â  Â  top: 2px; left: 2px; background-color: white;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
Â  Â  Â  Â  Â  Â  transform: translateX(0px);
Â  Â  Â  Â  Â  Â  transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
Â  Â  Â  Â  }
Â  Â  Â  Â  #role-switcher.driver #role-bg { transform: translateX(36px); }
Â  Â  Â  Â  #role-passenger-icon, #role-driver-icon { transition: opacity 0.3s ease-in-out; }
Â  Â  Â  Â  #role-passenger-icon span, #role-driver-icon span {
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  }
Â  Â  Â  Â  #role-switcher.passenger #role-passenger-icon span,
Â  Â  Â  Â  #role-switcher.driver #role-driver-icon span { transform: scale(1.15) rotate(-8deg); }
Â  Â  Â  Â  #role-switcher.passenger #role-driver-icon,
Â  Â  Â  Â  #role-switcher.driver #role-passenger-icon { opacity: 0.5; }
Â  Â  Â  Â  #profile-avatar-btn img { width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â  .modal-overlay { opacity: 0; transition: opacity 0.3s ease-in-out; }
Â  Â  Â  Â  .modal-overlay.show { opacity: 1; }
Â  Â  Â  Â  .modal.show { transform: translateY(0); }
Â  Â  Â  Â  .filter-type-btn.active { background-color: white; color: #1e293b; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
Â  Â  Â  Â  #filter-toggle-icon { transition: transform 0.3s ease-in-out; }
Â  Â  Â  Â  #filter-content {
Â  Â  Â  Â  Â  Â  max-height: 500px; overflow: hidden;
Â  Â  Â  Â  Â  Â  transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out; opacity: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  #filter-content.collapsed { max-height: 0; opacity: 0; }
Â  Â  Â  Â  #filter-toggle-btn.collapsed #filter-toggle-icon { transform: rotate(-180deg); }
Â  Â  Â  Â  #main-content::-webkit-scrollbar { width: 4px; }
Â  Â  Â  Â  #main-content::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
Â  Â  Â  Â  #main-content::-webkit-scrollbar-track { background: transparent; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Partner Widget Slider Styles */
Â  Â  Â  Â  .slider-container {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  border-radius: 0.75rem; /* rounded-xl */
Â  Â  Â  Â  }
Â  Â  Â  Â  .slider-track {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  transition: transform 0.5s ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .slide {
Â  Â  Â  Â  Â  Â  flex: 0 0 100%;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â  .slide-content {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  padding: 1rem; /* p-4 */
Â  Â  Â  Â  Â  Â  background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0));
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .slider-dots {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: 0.5rem; /* bottom-2 */
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 0.5rem; /* gap-2 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .dot {
Â  Â  Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  Â  Â  height: 8px;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.5);
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .dot.active {
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Custom file input */
Â  Â  Â  Â  .file-input-label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  border: 2px dashed #d1d5db;
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .file-input-label:hover {
Â  Â  Â  Â  Â  Â  background-color: #f9fafb;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Image Preview Grid */
Â  Â  Â  Â  #partner-image-preview-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  }
Â  Â  Â  Â  .preview-image-container {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding-top: 100%; /* 1:1 Aspect Ratio */
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  .preview-image {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  }
Â  Â  Â  Â  .preview-image-delete {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 4px;
Â  Â  Â  Â  Â  Â  right: 4px;
Â  Â  Â  Â  Â  Â  width: 20px;
Â  Â  Â  Â  Â  Â  height: 20px;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.6);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Toast Notification */
Â  Â  Â  Â  #toast-notification {
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -150%);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  #toast-notification.show {
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, 0);
Â  Â  Â  Â  }
Â  Â  Â  Â  #toast-notification.error { background-color: #ef4444; }
Â  Â  Â  Â  #toast-notification.success { background-color: #22c55e; }
Â  Â  </style>
</head>
<body class="bg-slate-50 text-slate-800 overflow-hidden">

Â  Â  <div id="toast-notification" class="fixed top-5 left-1/2 z-[100] px-4 py-2 rounded-lg text-white shadow-lg transition-transform duration-300">
Â  Â  Â  Â  <span id="toast-message"></span>
Â  Â  </div>

Â  Â  <div id="app-container" class="h-screen w-screen max-w-md mx-auto bg-white flex flex-col">
Â  Â  Â  Â  <header id="app-header" class="p-4 flex items-center justify-between bg-white border-b border-slate-200 flex-shrink-0 sticky top-0 z-10">
Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 flex items-center justify-start">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="backButton" data-action="back" class="text-slate-500 hover:text-slate-800 transition-colors invisible">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="role-switcher" class="flex items-center p-1 bg-slate-100 rounded-full cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="role-bg"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="role-passenger-icon" class="relative z-10 w-9 h-9 flex items-center justify-center text-xl"><span>ğŸ§</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="role-driver-icon" class="relative z-10 w-9 h-9 flex items-center justify-center text-xl"><span>ğŸš—</span></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 flex items-center justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="profile-avatar-btn" class="w-10 h-10 rounded-full bg-slate-200 text-slate-600 font-semibold flex items-center justify-center overflow-hidden shrink-0"></button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main id="main-content" class="flex-grow overflow-y-auto relative">
Â  Â  Â  Â  Â  Â  <div id="passenger-home-screen" class="screen active"></div>
Â  Â  Â  Â  Â  Â  <div id="driver-dashboard-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="offer-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="passenger-request-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="parcel-request-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="list-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="success-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="my-trips-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="profile-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="admin-screen" class="screen"></div>
Â  Â  Â  Â  Â  Â  <div id="partner-form-screen" class="screen"></div>
Â  Â  Â  Â  </main>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <footer id="app-footer" class="p-5 border-t border-slate-200 bg-white flex-shrink-0">
Â  Â  Â  Â  Â  Â  <a href="https://t.me/poputka12rus" target="_blank" class="text-sm btn w-full bg-sky-100 text-sky-800 font-bold py-3 px-4 rounded-xl hover:bg-sky-200 flex items-center justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  <span>ĞĞ°ÑˆĞ° Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ° Ğ² Telegram</span>
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </footer>
Â  Â  </div>

Â  Â  <div id="booking-modal-overlay" class="modal-overlay fixed inset-0 bg-black bg-opacity-40 z-40 hidden"></div>
Â  Â  <div id="booking-modal" class="modal fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto bg-transparent z-50 transform translate-y-full transition-transform duration-300">
Â  Â  Â  Â  <div class="p-4">
Â  Â  Â  Â  Â  Â  <div id="booking-options-container" class="space-y-2 bg-slate-100 rounded-xl"></div>
Â  Â  Â  Â  Â  Â  <button id="booking-modal-cancel-btn" class="w-full p-3 mt-2 bg-white rounded-xl text-blue-500 text-lg font-semibold">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <template id="passenger-home-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <div class="text-center mb-6"><h2 class="text-xl font-bold mb-1">Ğ§Ñ‚Ğ¾ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ?</h2></div>
Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="viewDriverOffers" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">Ğ¡Ğ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="navigateTo" data-screen="passenger-request-screen" class="text-sm btn w-full bg-slate-100 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-200">ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="myTrips" class="text-sm mt-4 btn w-full border border-slate-300 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-100">ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ Ğ¸ Ğ·Ğ°ÑĞ²ĞºĞ¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="mt-8 partner-widget-container"></div>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="driver-dashboard-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <div class="text-center mb-6"><h2 class="text-xl font-bold mb-1">ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ</h2></div>
Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="viewPassengerRequests" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">Ğ¡Ğ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºĞ¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="publishRide" class="text-sm btn w-full bg-slate-100 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-200">ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ñ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="myTrips" class="text-sm mt-4 btn w-full border border-slate-300 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-100">ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="mt-8 partner-widget-container"></div>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="partner-widget-template">
Â  Â  Â  Â  <h3 class="text-base font-bold text-slate-800 mb-3 text-center">ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€Ñ‹</h3>
Â  Â  Â  Â  <div class="partner-widget">
Â  Â  Â  Â  Â  Â  <div class="slider-container shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="slider-track"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="slider-dots"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <a id="partner-channel-link" href="#" target="_blank" class="mt-3 text-sm btn w-full bg-blue-100 text-blue-800 font-bold py-2 px-4 rounded-xl hover:bg-blue-200 flex items-center justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ² ĞºĞ°Ğ½Ğ°Ğ»
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </div>
Â  Â  </template>

Â  Â  <template id="list-screen-template">
Â  Â  Â  Â <div class="p-4 space-y-4">
Â  Â  Â  Â  Â  Â  <div id="filter-section-container" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="toggleFilter" id="filter-toggle-btn" class="flex justify-between items-center w-full mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-base font-semibold text-slate-800">Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg id="filter-toggle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500"><path d="m18 15-6-6-6 6"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-content" class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-from" class="block text-xs font-medium text-slate-600 mb-1">ĞÑ‚ĞºÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-from" name="from" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white"></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-to" class="block text-xs font-medium text-slate-600 mb-1">ĞšÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-to" name="to" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white"></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-date" class="block text-xs font-medium text-slate-600 mb-1">Ğ”Ğ°Ñ‚Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="filter-date" name="date" class="w-full p-2 border border-slate-200 rounded-lg text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-type-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-1">Ğ¢Ğ¸Ğ¿ Ğ·Ğ°ÑĞ²ĞºĞ¸</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-type-buttons" class="flex p-1 bg-slate-200 rounded-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-type="all" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600 active">Ğ’ÑĞµ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-type="ride" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600">ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ñ‹</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-type="parcel" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600">ĞŸĞ¾ÑÑ‹Ğ»ĞºĞ¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-3 pt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="resetFilters" class="flex-1 text-sm btn border border-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-100">Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="applyFilters" class="flex-1 text-sm btn bg-slate-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700">ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="list-container" class="space-y-3"></div>
Â  Â  Â  Â  Â  Â  <div id="no-results" class="text-center text-slate-500 py-10 hidden"><h3 id="no-results-title" class="text-base font-semibold"></h3><p id="no-results-text" class="text-xs"></p></div>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="success-screen-template">
Â  Â  Â  Â  <div class="p-5 flex flex-col items-center justify-center h-full text-center">
Â  Â  Â  Â  Â  Â  <div class="mb-4"><svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
Â  Â  Â  Â  Â  Â  <h2 id="success-title" class="text-xl font-bold mt-4 mb-1"></h2>
Â  Â  Â  Â  Â  Â  <p id="success-text" class="text-slate-600 mb-8 text-sm"></p>
Â  Â  Â  Â  Â  Â  <button data-action="backToHub" id="back-to-hub-btn" class="text-sm btn w-full max-w-xs bg-slate-800 text-white font-bold py-3 px-4 rounded-lg"></button>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="my-trips-screen-template">
Â  Â  Â  Â <div class="flex-1 flex flex-col p-5 space-y-4">
Â  Â  Â  Â  Â  Â  Â <div id="my-trips-container" class="space-y-4 flex-1"></div>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="profile-screen-template">
Â  Â  Â  Â <div class="p-5">
Â  Â  Â  Â  Â  Â  <h2 class="text-lg font-bold mb-4">ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</h2>
Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-600 mb-4">Ğ—Ğ´ĞµÑÑŒ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ. Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚Ğµ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ñ.</p>
Â  Â  Â  Â  Â  Â  <form id="profile-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="profile-name" class="block text-xs font-medium text-slate-600 mb-2">Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="full_name" id="profile-name" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="ĞĞ»ĞµĞºÑĞµĞ¹" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="profile-car" class="block text-xs font-medium text-slate-600 mb-2">ĞœĞ°Ñ€ĞºĞ° Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¼Ğ°ÑˆĞ¸Ğ½Ñ‹ (Ğ´Ğ»Ñ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="driver_car" id="profile-car" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="Kia Rio">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="text-sm btn w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  <div id="admin-actions" class="mt-6"></div>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="offer-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <h2 class="text-lg font-bold mb-4">Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞµ</h2>
Â  Â  Â  Â  Â  Â  <form id="offer-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞÑ‚ĞºÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="from" required><input type="hidden" name="to" required>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="ferry-toggle-container" class="hidden p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="via-ferry-toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">Ğ§ĞµÑ€ĞµĞ· Ğ¿Ğ°Ñ€Ğ¾Ğ¼</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="ferry-price-increase" class="text-sm text-slate-800 font-semibold hidden"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="via-ferry-toggle" name="via_ferry" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="cheboksary-detour-container" class="hidden p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="via-cheboksary-detour-toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">Ğ—Ğ°ĞµĞ·Ğ¶Ğ°Ñ Ğ² Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="via-cheboksary-detour-toggle" name="via_cheboksary_detour" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div></label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">Ğ”Ğ°Ñ‚Ğ° Ğ²Ñ‹ĞµĞ·Ğ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" name="ride_date" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹ĞµĞ·Ğ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="time" name="ride_time" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼ĞµÑÑ‚</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" name="seats" min="1" max="8" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 3" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ (<span id="publish-price"></span> â‚½)</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="passenger-request-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <h2 class="text-lg font-bold mb-4">Ğ’Ğ°ÑˆĞ° Ğ·Ğ°ÑĞ²ĞºĞ°</h2>
Â  Â  Â  Â  Â  Â  <form id="passenger-request-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞÑ‚ĞºÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="from" required><input type="hidden" name="to" required>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" name="ride_date" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">Ğ–ĞµĞ»Ğ°ĞµĞ¼Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹ĞµĞ·Ğ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="time-interval-buttons" class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" data-interval="Ğ£Ñ‚Ñ€Ğ¾ (6-11)" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-2xl mb-1">â˜€ï¸</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold text-sm">Ğ£Ñ‚Ñ€Ğ¾</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-slate-500">6:00 - 11:00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" data-interval="Ğ”ĞµĞ½ÑŒ (12-17)" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-2xl mb-1">ğŸ˜</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold text-sm">Ğ”ĞµĞ½ÑŒ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-slate-500">12:00 - 17:00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" data-interval="Ğ’ĞµÑ‡ĞµÑ€ (18-22)" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-2xl mb-1">ğŸŒ™</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold text-sm">Ğ’ĞµÑ‡ĞµÑ€</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-slate-500">18:00 - 22:00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" data-interval="Ğ›ÑĞ±Ğ¾Ğµ" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="text-2xl mb-1">ğŸ”„</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold text-sm">Ğ›ÑĞ±Ğ¾Ğµ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-slate-500">Ğ’ Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ½Ñ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="time_interval" id="timeIntervalInput" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-time text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="parcel-request-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <h2 class="text-lg font-bold mb-4">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ</h2>
Â  Â  Â  Â  Â  Â  <form id="parcel-request-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞÑ‚ĞºÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšÑƒĞ´Ğ°</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="from" required><input type="hidden" name="to" required>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div><label for="date-parcel" class="block text-xs font-medium text-slate-600 mb-2">Ğ”Ğ°Ñ‚Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸</label><input type="date" name="ride_date" id="date-parcel" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="parcel-price-info" class="bg-slate-100 p-3 rounded-lg text-center text-slate-600 text-sm">Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸: <span class="font-bold"></span> â‚½</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="text-sm btn w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </template>
Â  Â Â 
Â  Â  <template id="admin-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold">ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="addPartner" class="btn bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 text-sm">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="partners-list" class="space-y-3"></div>
Â  Â  Â  Â  </div>
Â  Â  </template>

Â  Â  <template id="partner-form-screen-template">
Â  Â  Â  Â  <div class="p-5">
Â  Â  Â  Â  Â  Â  <h2 id="partner-form-title" class="text-xl font-bold mb-4"></h2>
Â  Â  Â  Â  Â  Â  <form id="partner-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="id">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="partner-title" class="block text-xs font-medium text-slate-600 mb-2">Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" name="title" id="partner-title" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="partner-description" class="block text-xs font-medium text-slate-600 mb-2">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea name="description" id="partner-description" rows="3" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="partner-channel-url" class="block text-xs font-medium text-slate-600 mb-2">Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Telegram ĞºĞ°Ğ½Ğ°Ğ» (https://t.me/...)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" name="channel_url" id="partner-channel-url" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="partner-image-preview-grid" class="mb-2"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" id="partner-image-url-input" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° Ñ„Ğ¾Ñ‚Ğ¾...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" data-action="addUrl" class="btn bg-slate-200 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-300">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="file-input-label">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="file-input-text">... Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" name="image_files" id="partner-image-files" class="hidden" accept="image/*" multiple>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="partner-form-submit-btn" type="submit" class="text-sm btn w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </template>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â  <script>
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  const { createClient } = supabase;

Â  Â  Â  Â  const App = {
Â  Â  Â  Â  Â  Â  // --- CONFIGURATION ---
Â  Â  Â  Â  Â  Â  config: {
Â  Â  Â  Â  Â  Â  Â  Â  supabaseUrl: 'https://scqkpvmmoaolahpxinja.supabase.co',
Â  Â  Â  Â  Â  Â  Â  Â  supabaseAnonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcWtwdm1tb2FvbGFocHhpbmphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDIwNDksImV4cCI6MjA3MTE3ODA0OX0.Uz5L2SF8O1EGf_efkq5FLi6g1yl7LlmnTZi_eLnISMw',
Â  Â  Â  Â  Â  Â  Â  Â  prices: { base: 600, parcel: 300, cheboksary: 400, ferrySurcharge: 100 },
Â  Â  Â  Â  Â  Â  Â  Â  cities: ['Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°', 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹', 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº'],
Â  Â  Â  Â  Â  Â  Â  Â  adminId: 5017229451, // Hardcoded for initial check
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- STATE ---
Â  Â  Â  Â  Â  Â  state: {
Â  Â  Â  Â  Â  Â  Â  Â  currentUser: null,
Â  Â  Â  Â  Â  Â  Â  Â  userProfile: null,
Â  Â  Â  Â  Â  Â  Â  Â  userRole: 'passenger',
Â  Â  Â  Â  Â  Â  Â  Â  navigationHistory: ['passenger-home-screen'],
Â  Â  Â  Â  Â  Â  Â  Â  allRequests: [],
Â  Â  Â  Â  Â  Â  Â  Â  currentFilters: { from: '', to: '', date: '', type: 'all' },
Â  Â  Â  Â  Â  Â  Â  Â  partners: [],
Â  Â  Â  Â  Â  Â  Â  Â  editingPartner: null,
Â  Â  Â  Â  Â  Â  Â  Â  partnerFormImages: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  existing: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toAddFiles: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toAddUrls: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toDeleteUrls: []
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- DOM ELEMENTS CACHE ---
Â  Â  Â  Â  Â  Â  dom: {},

Â  Â  Â  Â  Â  Â  // --- SUPABASE CLIENT ---
Â  Â  Â  Â  Â  Â  supabase: null,
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- INITIALIZATION ---
Â  Â  Â  Â  Â  Â  async init() {
Â  Â  Â  Â  Â  Â  Â  Â  this.supabase = createClient(this.config.supabaseUrl, this.config.supabaseAnonKey);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.ready();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.expand();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.state.currentUser = Telegram.WebApp.initDataUnsafe?.user;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (!this.state.currentUser) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error("Not in Telegram");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.ui.setAppHeight();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.onEvent('viewportChanged', this.ui.setAppHeight);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ¼Ğ¾Ğº-Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.state.currentUser = { id: this.config.adminId, first_name: 'Admin', username: 'testadmin', photo_url: null };
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.state.currentUser?.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.innerHTML = '<div class="text-center p-8">ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Telegram.</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await this.api.ensureUserProfile();
Â  Â  Â  Â  Â  Â  Â  Â  this.cacheDom();
Â  Â  Â  Â  Â  Â  Â  Â  this.bindEvents();
Â  Â  Â  Â  Â  Â  Â  Â  this.ui.renderAllScreens();
Â  Â  Â  Â  Â  Â  Â  Â  this.ui.updateRoleSwitcher();
Â  Â  Â  Â  Â  Â  Â  Â  this.ui.updateAvatar();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Fetch partners based on role
Â  Â  Â  Â  Â  Â  Â  Â  if (this.state.userProfile.is_admin) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.ui.renderAdminButton();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await this.api.getAllPartnersForAdmin();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await this.api.getPublishedPartners();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.ui.renderPartnerWidgets();
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  cacheDom() {
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.backButton = document.getElementById('backButton');
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.mainContent = document.getElementById('main-content');
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // --- API CALLS (Data Layer) ---
Â  Â  Â  Â  Â  Â  api: {
Â  Â  Â  Â  Â  Â  Â  Â  async ensureUserProfile() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!App.state.currentUser) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let { data: profile, error } = await App.supabase.from('profiles').select('*').eq('id', App.state.currentUser.id).single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error && error.code === 'PGRST116') { // Profile doesn't exist, create it
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: newProfile, error: insertError } = await App.supabase.from('profiles')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: App.state.currentUser.id,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: App.state.currentUser.username,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  full_name: App.state.currentUser.first_name || 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  is_admin: App.state.currentUser.id === App.config.adminId // Set admin on creation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (insertError) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ:', insertError);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast(`ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ: ${insertError.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  profile = newProfile;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ:', error);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.userProfile = profile;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async updateUserProfile(profileData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase.from('profiles')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .update(profileData)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', App.state.currentUser.id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast(`ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ: ${error.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // --- Partners API ---
Â  Â  Â  Â  Â  Â  Â  Â  async getPublishedPartners() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('partners')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('is_published', true)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('created_at', { ascending: false });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ¾Ğ²:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partners = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partners = data || [];
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async getAllPartnersForAdmin() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase.from('partners').select('*').order('created_at', { ascending: false });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ¾Ğ²:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partners = data || [];
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async updatePartnerStatus(partnerId, is_published) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('partners')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .update({ is_published })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', partnerId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return data;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async uploadPartnerImage(file) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileName = `${Date.now()}-${file.name}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase.storage.from('partner_images').upload(fileName, file);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const publicUrlData = App.supabase.storage.from('partner_images').getPublicUrl(fileName);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (publicUrlData.error || !publicUrlData.data.publicUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ public URL:', publicUrlData.error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Try to delete the uploaded file if getting URL fails, to avoid orphaned files
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await App.supabase.storage.from('partner_images').remove([fileName]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return publicUrlData.data.publicUrl;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async deletePartnerImage(imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!imageUrl || !imageUrl.includes(App.config.supabaseUrl)) return; // Don't delete external URLs
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileName = imageUrl.split('/').pop();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await App.supabase.storage.from('partner_images').remove([fileName]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Could not delete image, it might not exist in storage:", fileName);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  // ================== Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯ ==================
Â  Â  Â  Â  Â  Â  Â  Â  async savePartner(partnerData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾: Ñ‚ĞµĞ¿ĞµÑ€ÑŒ ÑÑ‚Ğ° Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¸ ÑÑ€Ğ°Ğ·Ñƒ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞµÑ‚ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñƒ.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dataToSave = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: partnerData.title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: partnerData.description,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image_urls: partnerData.image_urls,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  channel_url: partnerData.channel_url,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  is_published: true // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: Ğ²ÑĞµĞ³Ğ´Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ is_published Ğ² true Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let result;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (partnerData.id) { // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  result = await App.supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('partners')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .update(dataToSave)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', partnerData.id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  result = await App.supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('partners')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert(dataToSave)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (result.error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°:', result.error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return result.data;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // ==========================================================
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  async deletePartner(partnerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await App.supabase.from('partners').delete().eq('id', partnerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°:', error); return false; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // --- EVENT HANDLERS (Controller Layer) ---
Â  Â  Â  Â  Â  Â  bindEvents() {
Â  Â  Â  Â  Â  Â  Â  Â  document.body.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const button = target.closest('button, [data-action]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!button) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { action, screen, ...dataset } = button.dataset;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const actions = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Navigation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  navigateTo: () => this.navigation.to(screen),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  back: () => this.navigation.back(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backToHub: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hubScreen = this.state.userRole === 'driver' ? 'driver-dashboard-screen' : 'passenger-home-screen';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to(hubScreen, { resetHistory: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Main actions
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switchRole: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.state.userRole = this.state.userRole === 'passenger' ? 'driver' : 'passenger';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.ui.updateRoleSwitcher();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newScreen = this.state.userRole === 'passenger' ? 'passenger-home-screen' : 'driver-dashboard-screen';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to(newScreen, { resetHistory: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  viewDriverOffers: this.handlers.onViewDriverOffers,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  viewPassengerRequests: this.handlers.onViewPassengerRequests,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  myTrips: this.handlers.onMyTrips,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publishRide: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!this.state.userProfile?.driver_car?.trim()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.ui.showToast("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ²Ğ°ÑˆĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ğµ Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('profile-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('offer-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // List item actions
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  requestBooking: () => this.handlers.onRequestBooking(dataset.offerId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  detourBooking: () => this.ui.showBookingOptionsModal(JSON.parse(decodeURIComponent(dataset.offer))),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmBookingSegment: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.ui.hideBookingModal();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onRequestBooking(dataset.offerId, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  segment: dataset.segment,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: parseInt(dataset.price),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: dataset.from,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: dataset.toÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelBooking: () => this.handlers.onCancelBooking(dataset.bookingId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  offerRide: () => this.handlers.onOfferRideToRequest(dataset.requestId, button),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateBookingStatus: () => this.handlers.onUpdateBookingStatus(dataset.bookingId, dataset.status),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteOffer: () => this.handlers.onDeleteOffer(dataset.offerId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelRequest: () => this.handlers.onCancelRequest(dataset.requestId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelParcelRequest: () => this.handlers.onCancelParcelRequest(dataset.requestId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Modals & Filters
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideModal: this.ui.hideBookingModal,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleFilter: this.ui.toggleFilter,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  applyFilters: this.handlers.onApplyFilters,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resetFilters: this.handlers.onResetFilters,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Admin Actions
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addPartner: () => this.handlers.onAddPartner(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editPartner: () => this.handlers.onEditPartner(dataset.partnerId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deletePartner: () => this.handlers.onDeletePartner(dataset.partnerId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  togglePublish: () => this.handlers.onTogglePublish(dataset.partnerId),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deletePreviewImage: () => this.handlers.onDeletePreviewImage(button),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addUrl: () => this.handlers.onAddUrl(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (actions[action]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actions[action]();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (target.closest('#time-interval-buttons')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onTimeSelect(button);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (button.classList.contains('filter-type-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onFilterTypeSelect(button);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  document.body.addEventListener('submit', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formHandlers = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'profile-form': this.handlers.onProfileSubmit,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'offer-form': this.handlers.onOfferSubmit,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'passenger-request-form': this.handlers.onPassengerRequestSubmit,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'parcel-request-form': this.handlers.onParcelRequestSubmit,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'partner-form': this.handlers.onPartnerFormSubmit,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (formHandlers[e.target.id]) formHandlers[e.target.id](e.target);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â document.body.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (['via-ferry-toggle', 'via-cheboksary-detour-toggle'].includes(e.target.id)) this.handlers.onRouteOptionChange(e.target);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (['from-select', 'to-select'].includes(e.target.name)) this.handlers.onRouteDropdownChange(e.target);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.id === 'partner-image-files') this.handlers.onPartnerImageChange(e.target);
Â  Â  Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // --- ACTION HANDLERS (Business Logic) ---
Â  Â  Â  Â  Â  Â  handlers: {
Â  Â  Â  Â  Â  Â  Â  Â  async onProfileSubmit(form) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fullName = formData.get('full_name').trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!fullName) { App.ui.showToast("Ğ˜Ğ¼Ñ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼."); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updatedProfile = await App.api.updateUserProfile({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  full_name: fullName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_car: formData.get('driver_car').trim()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (updatedProfile) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.userProfile = updatedProfile;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.updateAvatar();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.back();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  async onOfferSubmit(form) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = Object.fromEntries(formData.entries());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.from || !data.to) { form.querySelector('.form-error-direction').classList.remove('hidden'); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCheboksaryRoute = data.from === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹' || data.to === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.price = isCheboksaryRoute ? App.config.prices.cheboksary : (data.via_ferry ? App.config.prices.base + App.config.prices.ferrySurcharge : App.config.prices.base);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const offerData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_id: App.state.currentUser.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: data.from,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: data.to,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_date: data.ride_date,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_time: data.ride_time,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  seats: parseInt(data.seats),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: data.price,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  via_ferry: !!data.via_ferry,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  via_cheboksary_detour: !!data.via_cheboksary_detour
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await App.supabase.from('ride_offers').insert(offerData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); App.ui.showToast(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: ${error.message}`); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.resetForm(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showSuccess('ĞŸĞ¾ĞµĞ·Ğ´ĞºĞ° Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ°', 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ñ‹ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ²Ğ°ÑˆĞµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ.', 'Ğ’ ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚');
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  async onPassengerRequestSubmit(form) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = Object.fromEntries(formData.entries());

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.from || !data.to || !data.time_interval) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.from || !data.to) form.querySelector('.form-error-direction').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.time_interval) form.querySelector('.form-error-time').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const requestData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  passenger_id: App.state.currentUser.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: data.from,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: data.to,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_date: data.ride_date,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time_interval: data.time_interval,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: (data.from === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹' || data.to === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹') ? App.config.prices.cheboksary : App.config.prices.base
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await App.supabase.from('ride_requests').insert(requestData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); App.ui.showToast(`ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°ÑĞ²ĞºĞ¸: ${error.message}`); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.resetForm(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showSuccess('Ğ—Ğ°ÑĞ²ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°', 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ ÑƒĞ²Ğ¸Ğ´ÑÑ‚ Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ.', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  async onParcelRequestSubmit(form) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = Object.fromEntries(formData.entries());

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data.from || !data.to) { form.querySelector('.form-error-direction').classList.remove('hidden'); return; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parcelData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sender_id: App.state.currentUser.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: data.from,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: data.to,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_date: data.ride_date,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: App.config.prices.parcel
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await App.supabase.from('parcel_requests').insert(parcelData);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); App.ui.showToast(`ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°ÑĞ²ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ: ${error.message}`); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.resetForm(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showSuccess('Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğ° Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°', 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ ÑƒĞ²Ğ¸Ğ´ÑÑ‚ Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ.', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾');
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  async onViewDriverOffers() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('list-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-section-container').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderList([], 'driverOffer', true); // Show loader

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: offers, error } = await App.supabase.from('ride_offers_with_seats')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', new Date().toISOString().split('T')[0])
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gt('seats_left', 0)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_date', { ascending: true })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_time', { ascending: true });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); App.ui.renderList([], 'driverOffer'); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: userBookings } = await App.supabase.from('bookings')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('id, offer_id')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('passenger_id', App.state.currentUser.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userBookingsMap = new Map(userBookings?.map(b => [b.offer_id, b.id]) || []);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const augmentedOffers = offers.map(offer => ({ ...offer, currentUserBookingId: userBookingsMap.get(offer.id) || null }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderList(augmentedOffers, 'driverOffer');
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  async onViewPassengerRequests() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('list-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-section-container').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderList([], 'passengerRequest', true); // Show loader

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-date').setAttribute('min', today);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase.from('all_requests').select('*');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); App.ui.renderList([], 'passengerRequest'); return; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.allRequests = data || [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.handlers.onResetFilters();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  async onMyTrips() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('my-trips-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('my-trips-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = App.ui.getLoaderHTML();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.userRole === 'driver') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await App.supabase.from('ride_offers')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select(`*, bookings(*, passenger:profiles(full_name, username))`)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('driver_id', App.state.currentUser.id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', new Date().toISOString().split('T')[0])
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_date', { ascending: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); container.innerHTML = App.ui.getErrorHTML("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ¾Ğº"); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderMyTrips(data, 'driver');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date(); today.setHours(0,0,0,0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const [bookingsRes, requestsRes, parcelsRes] = await Promise.all([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.supabase.from('bookings').select(`*, offer:ride_offers(*, driver:profiles(full_name, driver_car, username))`).eq('passenger_id', App.state.currentUser.id),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.supabase.from('ride_requests').select(`*`).eq('passenger_id', App.state.currentUser.id).gte('ride_date', new Date().toISOString().split('T')[0]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.supabase.from('parcel_requests').select(`*`).eq('sender_id', App.state.currentUser.id).gte('ride_date', new Date().toISOString().split('T')[0])
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (bookingsRes.error || requestsRes.error || parcelsRes.error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â container.innerHTML = App.ui.getErrorHTML("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"); return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const activeBookings = (bookingsRes.data || []).filter(b => b.offer && new Date(b.offer.ride_date) >= today);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderMyTrips({ bookings: activeBookings, requests: requestsRes.data, parcels: parcelsRes.data }, 'passenger');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  async onRequestBooking(offerId, bookingDetails = null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: offer, error: offerError } = await App.supabase.from('ride_offers').select('*').eq('id', offerId).single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(offerError || !offer) { console.error("ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾"); App.ui.showToast(`ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ: ${offerError.message}`); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bookingData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  offer_id: offerId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  passenger_id: App.state.currentUser.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'pending',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  booking_segment: bookingDetails?.segment || 'full',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: bookingDetails?.price || offer.price,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from_city: bookingDetails?.from || offer.from,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to_city: bookingDetails?.to || offer.to,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await App.supabase.from('bookings').insert(bookingData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:', error); App.ui.showToast(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: ${error.message}`); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.utils.sendTelegramNotification(offer.driver_id, `*ĞĞ¾Ğ²Ğ¾Ğµ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ!* ğŸš—\nĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ *${App.state.userProfile.full_name}* Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ¾ Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ ${offer.from} â†’ ${offer.to}.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showSuccess('Ğ—Ğ°ÑĞ²ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ°', 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚ Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ¸ Ğ²Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ.', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â async onUpdateBookingStatus(bookingId, status) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: booking, error } = await App.supabase.from('bookings').update({ status }).eq('id', bookingId).select('*, offer:ride_offers(*)').single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ±Ñ€Ğ¾Ğ½Ğ¸:', error); return; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const message = status === 'confirmed' ? `*Ğ‘Ñ€Ğ¾Ğ½ÑŒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ°!* âœ…` : `*Ğ‘Ñ€Ğ¾Ğ½ÑŒ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ°* âŒ`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.utils.sendTelegramNotification(booking.passenger_id, `${message}\nĞ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ» Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ ${booking.offer.from} â†’ ${booking.offer.to}.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.handlers.onMyTrips(); // Refresh the list
Â  Â  Â  Â  Â  Â  Â  Â  Â },

Â  Â  Â  Â  Â  Â  Â  Â  async onCancelBooking(bookingId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: booking } = await App.supabase.from('bookings').select('offer:ride_offers(driver_id)').eq('id', bookingId).single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await App.supabase.from('bookings').delete().eq('id', bookingId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(error) { console.error(error); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (booking?.offer?.driver_id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.utils.sendTelegramNotification(booking.offer.driver_id, `ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ±Ñ€Ğ¾Ğ½ÑŒ Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.navigationHistory.at(-1) === 'list-screen') App.handlers.onViewDriverOffers();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else App.handlers.onMyTrips();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â async onDeleteOffer(offerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const { data: bookings } = await App.supabase.from('bookings').select('passenger_id').eq('offer_id', offerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (bookings?.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const notifications = bookings.map(b => App.utils.sendTelegramNotification(b.passenger_id, `*ĞŸĞ¾ĞµĞ·Ğ´ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼* âŒ`));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await Promise.all(notifications);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await App.supabase.from('ride_offers').delete().eq('id', offerId); // Bookings will be deleted by CASCADE
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â App.handlers.onMyTrips();
Â  Â  Â  Â  Â  Â  Â  Â  Â },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  async onCancelRequest(requestId) { await App.supabase.from('ride_requests').delete().eq('id', requestId); App.handlers.onMyTrips(); },
Â  Â  Â  Â  Â  Â  Â  Â  async onCancelParcelRequest(requestId) { await App.supabase.from('parcel_requests').delete().eq('id', requestId); App.handlers.onMyTrips(); },

Â  Â  Â  Â  Â  Â  Â  Â  async onOfferRideToRequest(requestId, button) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!App.state.userProfile?.driver_car?.trim()) { App.ui.showToast("Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ²Ñ‚Ğ¾ Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ."); App.navigation.to('profile-screen'); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°...';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: request, error } = await App.supabase.from('ride_requests').select('*').eq('id', requestId).single();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error || !request) { console.error("Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°:", error); button.disabled = false; return; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let timeForOffer;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const interval = request.time_interval || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (interval.includes('Ğ£Ñ‚Ñ€Ğ¾')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeForOffer = '06:00';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (interval.includes('Ğ”ĞµĞ½ÑŒ')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeForOffer = '12:00';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (interval.includes('Ğ’ĞµÑ‡ĞµÑ€')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeForOffer = '18:00';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // Covers "Ğ›ÑĞ±Ğ¾Ğµ" and any unexpected cases
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timeForOffer = '12:00';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { error: offerError } = await App.supabase.rpc('create_offer_and_booking_for_request', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p_request_id: requestId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p_driver_id: App.state.currentUser.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p_ride_time: timeForOffer
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (offerError) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ:", offerError);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast(`ĞÑˆĞ¸Ğ±ĞºĞ°: ${offerError.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.utils.sendTelegramNotification(request.passenger_id, `*Ğ’Ğ°Ğ¼ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ!* ğŸš—\nĞ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ *${App.state.userProfile.full_name}* Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ½ÑƒĞ»ÑÑ Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.remove('bg-green-500', 'hover:bg-green-600');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('bg-slate-400', 'cursor-not-allowed');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // --- ADMIN HANDLERS (REVISED) ---
Â  Â  Â  Â  Â  Â  Â  Â  onAddPartner() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.editingPartner = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerForm();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('partner-form-screen');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onEditPartner(partnerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const partner = App.state.partners.find(p => p.id == partnerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (partner) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.editingPartner = partner;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerForm(partner);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('partner-form-screen');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async onTogglePublish(partnerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const partner = App.state.partners.find(p => p.id == partnerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!partner) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const updatedPartner = await App.api.updatePartnerStatus(partner.id, !partner.is_published);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (updatedPartner) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partner.is_published = updatedPartner.is_published;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast(updatedPartner.is_published ? 'ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½!' : 'ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€ ÑĞ½ÑÑ‚ Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸.', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderAdminScreen();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerWidgets();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async onDeletePartner(partnerId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const button = document.querySelector(`[data-partner-id="${partnerId}"][data-action="deletePartner"]`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isConfirming = button.dataset.confirming === 'true';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isConfirming) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'Ğ¢Ğ¾Ñ‡Ğ½Ğ¾?';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('bg-red-500', 'text-white');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.dataset.confirming = 'true';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'Ğ£Ğ´Ğ°Ğ».';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.remove('bg-red-500', 'text-white');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.dataset.confirming = 'false';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const partnerToDelete = App.state.partners.find(p => p.id == partnerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const success = await App.api.deletePartner(partnerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (partnerToDelete.image_urls && partnerToDelete.image_urls.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const deletePromises = partnerToDelete.image_urls.map(url => App.api.deletePartnerImage(url));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â await Promise.all(deletePromises);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast('ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€ ÑƒĞ´Ğ°Ğ»ĞµĞ½', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const index = App.state.partners.findIndex(p => p.id == partnerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (index !== -1) App.state.partners.splice(index, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderAdminScreen();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerWidgets();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  async onPartnerFormSubmit(form) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const submitButton = document.getElementById('partner-form-submit-btn');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (submitButton.disabled) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.textContent = 'ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = formData.get('id');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = formData.get('title').trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const description = formData.get('description').trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const channel_url = formData.get('channel_url').trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!title || !description || !channel_url) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Ğ’ÑĞµ Ğ¿Ğ¾Ğ»Ñ (Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº, ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ, Ğ¡ÑÑ‹Ğ»ĞºĞ°) Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 1: Handle image uploads
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.textContent = 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ¾Ñ‚Ğ¾...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const uploadPromises = App.state.partnerFormImages.toAddFiles.map(file => App.api.uploadPartnerImage(file));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newImageUrls = await Promise.all(uploadPromises);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(newImageUrls.some(url => url === null)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 2: Handle image deletions from storage
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.textContent = 'ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ°...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const deletePromises = App.state.partnerFormImages.toDeleteUrls.map(url => App.api.deletePartnerImage(url));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all(deletePromises);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 3: Construct the final list of URLs
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const finalImageUrls = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...App.state.partnerFormImages.existing,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...newImageUrls,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...App.state.partnerFormImages.toAddUrls
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ].filter(url => url); // Filter out any null/empty URLs

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (finalImageUrls.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Ğ”Ğ»Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ° Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const partnerData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: id ? parseInt(id) : null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  channel_url,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image_urls: finalImageUrls,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 4: Save partner data to the database
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.textContent = 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const savedPartner = await App.api.savePartner(partnerData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (savedPartner) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 5: Refetch all partners to ensure the list is up-to-date.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await App.api.getAllPartnersForAdmin();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 6: Update UI that depends on the partner list
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerWidgets();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 7: Navigate back (which will re-render the admin screen) and show success
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.back();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast('ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½ Ğ¸ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½!', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast(error.message || 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  submitButton.textContent = 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â onPartnerImageChange(input) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const files = Array.from(input.files);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages.toAddFiles.push(...files);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerFormPreviews();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onAddUrl() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const input = document.getElementById('partner-image-url-input');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = input.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (url) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  new URL(url); // Basic validation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages.toAddUrls.push(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerFormPreviews();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.showToast('ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½ÑƒÑ ÑÑÑ‹Ğ»ĞºÑƒ.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onDeletePreviewImage(button) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = button.dataset.url;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileIndex = parseInt(button.dataset.fileIndex, 10);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newUrlIndex = parseInt(button.dataset.newUrlIndex, 10);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (url) { // Deleting an existing image
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingIndex = App.state.partnerFormImages.existing.indexOf(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (existingIndex > -1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages.existing.splice(existingIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages.toDeleteUrls.push(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (!isNaN(fileIndex)) { // Deleting a new file
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages.toAddFiles.splice(fileIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (!isNaN(newUrlIndex)) { // Deleting a new URL
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages.toAddUrls.splice(newUrlIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderPartnerFormPreviews();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // --- UI RELATED HANDLERS ---
Â  Â  Â  Â  Â  Â  Â  Â  onApplyFilters() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.currentFilters = { from: document.getElementById('filter-from').value, to: document.getElementById('filter-to').value, date: document.getElementById('filter-date').value, type: document.querySelector('#filter-type-buttons .active').dataset.type };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderFilteredList();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onResetFilters() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.currentFilters = { from: '', to: '', date: '', type: 'all' };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-from').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-to').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-date').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#filter-type-buttons .filter-type-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.type === 'all'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.renderFilteredList();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onFilterTypeSelect(button) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.parentElement.querySelectorAll('.filter-type-btn').forEach(btn => btn.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onTimeSelect(button) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const form = button.closest('form');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.parentElement.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#timeIntervalInput').value = button.dataset.interval;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-time').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onRouteOptionChange(checkbox) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const form = checkbox.closest('form');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (checkbox.id === 'via-ferry-toggle' && checkbox.checked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#via-cheboksary-detour-toggle').checked = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.onRouteDropdownChange(form.querySelector('select[name="from-select"]'));
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  onRouteDropdownChange(selectElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const form = selectElement.closest('form');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fromSelect = form.querySelector('select[name="from-select"]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toSelect = form.querySelector('select[name="to-select"]');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('input[name="from"]').value = fromSelect.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('input[name="to"]').value = toSelect.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Array.from(toSelect.options).forEach(opt => { opt.disabled = opt.value === fromSelect.value; });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Array.from(fromSelect.options).forEach(opt => { opt.disabled = opt.value === toSelect.value; });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isKozYoRoute = (fromSelect.value === 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº' && toSelect.value === 'Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°') || (fromSelect.value === 'Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°' && toSelect.value === 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ferryContainer = form.querySelector('#ferry-toggle-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const detourContainer = form.querySelector('#cheboksary-detour-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ferryToggle = form.querySelector('#via-ferry-toggle');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ferryContainer) ferryContainer.classList.toggle('hidden', !isKozYoRoute);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (detourContainer) detourContainer.classList.toggle('hidden', !(isKozYoRoute && !ferryToggle.checked));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.ui.updateOfferPrice(form);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  // --- NAVIGATION ---
Â  Â  Â  Â  Â  Â  navigation: {
Â  Â  Â  Â  Â  Â  Â  Â  to(screenId, { resetHistory = false, addToHistory = true } = {}) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const screenElement = document.getElementById(screenId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!screenElement) { console.error(`Screen "${screenId}" not found.`); return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  screenElement.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (resetHistory) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.navigationHistory = [screenId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (addToHistory && App.state.navigationHistory.at(-1) !== screenId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.navigationHistory.push(screenId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.dom.backButton.classList.toggle('invisible', App.state.navigationHistory.length <= 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.dom.mainContent.scrollTop = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Pre-population logic
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (screenId === 'profile-screen') App.ui.populateProfileForm();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (screenId === 'offer-screen') App.handlers.onRouteDropdownChange(document.querySelector('#offer-form select'))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (screenId === 'admin-screen') App.ui.renderAdminScreen();
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  back() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.navigationHistory.length <= 1) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.navigationHistory.pop();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastScreen = App.state.navigationHistory.at(-1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.to(lastScreen, { addToHistory: false });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- UI & RENDER ---
Â  Â  Â  Â  Â  Â  ui: {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(message, type = 'error') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toast = document.getElementById('toast-notification');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const messageEl = document.getElementById('toast-message');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!toast || !messageEl) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (type === 'error') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Toast Error:", message);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageEl.textContent = message;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toast.className = 'fixed top-5 left-1/2 z-[100] px-4 py-2 rounded-lg text-white shadow-lg transition-transform duration-300'; // Reset classes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toast.classList.add(type);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toast.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toast.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  setAppHeight() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const appContainer = document.getElementById('app-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (appContainer && window.Telegram?.WebApp?.viewportStableHeight) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appContainer.style.height = `${window.Telegram.WebApp.viewportStableHeight}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  renderAllScreens() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const templates = document.querySelectorAll('template');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  templates.forEach(template => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const screenId = template.id.replace('-template', '');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const screen = document.getElementById(screenId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Don't render the partner widget here, it's dynamic now
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (screen && !template.id.startsWith('partner-widget')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â screen.innerHTML = template.innerHTML;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.setDefaultDates();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.populateSelects();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const offerPriceSpan = document.querySelector('#offer-form #publish-price');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (offerPriceSpan) offerPriceSpan.textContent = App.config.prices.base;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parcelPriceSpan = document.querySelector('#parcel-request-form #parcel-price-info span');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(parcelPriceSpan) parcelPriceSpan.textContent = App.config.prices.parcel;
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  updateRoleSwitcher() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const switcher = document.getElementById('role-switcher');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.classList.toggle('driver', App.state.userRole === 'driver');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.classList.toggle('passenger', App.state.userRole === 'passenger');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.dataset.action = 'switchRole';
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  updateAvatar() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const avatarBtn = document.getElementById('profile-avatar-btn');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarBtn.dataset.action = 'navigateTo';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarBtn.dataset.screen = 'profile-screen';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!avatarBtn || !App.state.currentUser) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(App.state.currentUser.photo_url) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarBtn.innerHTML = `<img src="${App.state.currentUser.photo_url}" alt="Avatar">`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const initials = (App.state.userProfile?.full_name || App.state.currentUser.first_name || '?').charAt(0).toUpperCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarBtn.innerHTML = `<span>${initials}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  renderList(items, type, isLoading = false) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('list-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const noResults = document.getElementById('no-results');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isLoading) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = this.getLoaderHTML();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noResults.classList.add('hidden'); return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!items || items.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noResults.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('no-results-title').textContent = type === 'driverOffer' ? 'ĞŸĞ¾ĞµĞ·Ğ´Ğ¾Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾' : 'Ğ—Ğ°ÑĞ²Ğ¾Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('no-results-text').textContent = type === 'driverOffer' ? 'ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ·Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ÑĞ²Ğ¾Ñ Ğ·Ğ°ÑĞ²ĞºÑƒ.' : 'ĞŸĞ¾ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noResults.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cardRenderer = type === 'driverOffer' ? this.getDriverOfferCard : this.getPassengerRequestCard;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = items.map(item => `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${cardRenderer.call(this, item)}</div>`).join('');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderFilteredList() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let filtered = [...App.state.allRequests];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { from, to, date, type } = App.state.currentFilters;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (from) filtered = filtered.filter(r => r.from === from);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (to) filtered = filtered.filter(r => r.to === to);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (date) filtered = filtered.filter(r => r.ride_date === date);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (type !== 'all') filtered = filtered.filter(r => r.type === (type === 'ride' ? 'ride_request' : 'parcel_request'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.renderList(filtered, 'passengerRequest');
Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  renderMyTrips(data, role) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('my-trips-container');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (role === 'driver') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data || data.length === 0) { container.innerHTML = `<div class="text-center text-slate-500 py-10"><h3 class="text-base font-semibold">Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾ĞµĞ·Ğ´Ğ¾Ğº</h3></div>`; return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = data.map(offer => `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyDriverOfferCard(offer)}</div>`).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { bookings, requests, parcels } = data;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!bookings?.length && !requests?.length && !parcels?.length) { container.innerHTML = `<div class="text-center text-slate-500 py-10"><h3 class="text-base font-semibold">Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ĞµĞ¹</h3></div>`; return; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let content = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (bookings?.length) content += `<h3 class="text-base font-bold text-slate-800 px-1 pt-2">ĞœĞ¾Ğ¸ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</h3>` + bookings.map(b => `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyBookingCard(b)}</div>`).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (requests?.length) content += `<h3 class="text-base font-bold text-slate-800 px-1 pt-4">ĞœĞ¾Ğ¸ Ğ·Ğ°ÑĞ²ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸</h3>` + requests.map(r => `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyRequestCard(r)}</div>`).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (parcels?.length) content += `<h3 class="text-base font-bold text-slate-800 px-1 pt-4">ĞœĞ¾Ğ¸ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºĞ¸</h3>` + parcels.map(p => `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyParcelRequestCard(p)}</div>`).join('');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = content;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  showSuccess(title, text, buttonText) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('success-title').textContent = title;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('success-text').textContent = text;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('back-to-hub-btn').textContent = buttonText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('success-screen');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // --- ADMIN UI ---
Â  Â  Â  Â  Â  Â  Â  Â  renderAdminButton() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('admin-actions');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(container) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<button data-action="navigateTo" data-screen="admin-screen" class="text-sm btn w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700">ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  renderAdminScreen() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('partners-list');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!container) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.partners.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<p class="text-slate-500 text-center">ĞŸĞ°Ñ€Ñ‚Ğ½ĞµÑ€Ñ‹ ĞµÑ‰Ğµ Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = App.state.partners.map(p => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imageUrl = (p.image_urls && p.image_urls.length > 0)Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? p.image_urls[0]Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'https://placehold.co/64x64/e2e8f0/64748b?text=ĞĞµÑ‚%20Ñ„Ğ¾Ñ‚Ğ¾';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isPublished = p.is_published;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const publishBtnClass = isPublished ? 'bg-amber-100 text-amber-700' : 'bg-green-100 text-green-700';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const publishBtnText = isPublished ? 'Ğ¡Ğ½ÑÑ‚ÑŒ' : 'ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white border border-slate-200 rounded-xl p-3 flex items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${imageUrl}" alt="${p.title}" class="w-16 h-16 object-cover rounded-lg shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow min-w-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold truncate">${p.title}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs ${isPublished ? 'text-green-600 font-semibold' : 'text-slate-500'}">${isPublished ? 'â— ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ¾' : 'â—‹ Ğ§ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col gap-2 shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-action="togglePublish" data-partner-id="${p.id}" class="text-xs btn ${publishBtnClass} font-semibold py-1 px-3 rounded-md">${publishBtnText}</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-action="editPartner" data-partner-id="${p.id}" class="text-xs btn bg-slate-100 text-slate-700 font-semibold py-1 px-3 rounded-md">Ğ˜Ğ·Ğ¼.</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button data-action="deletePartner" data-partner-id="${p.id}" data-confirming="false" class="text-xs btn bg-red-100 text-red-700 font-semibold py-1 px-3 rounded-md transition-colors">Ğ£Ğ´Ğ°Ğ».</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('');
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  renderPartnerForm(partner = null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const form = document.getElementById('partner-form');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = document.getElementById('partner-form-title');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.partnerFormImages = { existing: [], toAddFiles: [], toAddUrls: [], toDeleteUrls: [] };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.reset();
