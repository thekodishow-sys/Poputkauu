<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ü–æ–ø—É—Ç–∫–∞ 12</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
        }
        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .screen.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            transform: translateY(150%);
            transition: transform 0.3s ease-out;
            pointer-events: none;
        }
        .toast.show {
            transform: translateY(0);
            pointer-events: auto;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        .role-btn.active, .direction-buttons button.active, #time-interval-buttons button.active {
            background-color: #1e293b; /* bg-slate-800 */
            color: white;
        }
        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background-color: #ef4444; /* red-500 */
            border-radius: 9999px;
            border: 1px solid white;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 overflow-hidden">

    <div id="app-container" class="h-screen w-screen max-w-md mx-auto bg-white flex flex-col">
        <!-- –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä -->
        <header id="app-header" class="p-4 flex items-center justify-between bg-white border-b border-slate-200 flex-shrink-0 sticky top-0 z-10">
            <button id="backButton" class="text-slate-500 hover:text-slate-800 transition-colors invisible">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <h1 id="headerTitle" class="text-lg font-semibold text-slate-800 text-center flex-grow">–ü–æ–ø—É—Ç–∫–∞ 12</h1>
            <!-- –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞ (–ø–æ–∫–∞ –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞) -->
            <div class="w-6"></div>
        </header>

        <main id="main-content" class="flex-grow overflow-y-auto p-5 relative">
            <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ -->
            <div id="main-screen" class="screen active">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold mb-1">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                    <p class="text-slate-500">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ä–æ–ª—å</p>
                </div>
                <div id="role-selector" class="mb-6 p-1 bg-slate-100 rounded-xl flex">
                    <button data-role="passenger" class="role-btn btn flex-1 py-3 px-4 rounded-lg font-semibold text-slate-500 transition-colors">–ü–∞—Å—Å–∞–∂–∏—Ä</button>
                    <button data-role="driver" class="role-btn btn flex-1 py-3 px-4 rounded-lg font-semibold text-slate-500 transition-colors">–í–æ–¥–∏—Ç–µ–ª—å</button>
                </div>
                <button id="continue-btn" class="btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700 transition-all disabled:bg-slate-300 disabled:shadow-none disabled:cursor-not-allowed" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>

            <!-- –≠–∫—Ä–∞–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            <div id="route-selection-screen" class="screen"></div>
            <div id="passenger-home-screen" class="screen"></div>
            <div id="driver-dashboard-screen" class="screen"></div>
            <div id="offer-screen" class="screen"></div>
            <div id="passenger-request-screen" class="screen"></div>
            <div id="parcel-request-screen" class="screen"></div>
            <div id="list-screen" class="screen"></div>
            <div id="success-screen" class="screen"></div>
        </main>
        
        <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Toast) -->
        <div id="toast" class="toast fixed bottom-6 left-1/2 -translate-x-1/2 w-11/12 max-w-sm p-4 rounded-lg shadow-lg text-white text-center z-50"><p id="toast-message"></p></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE ---
    const SUPABASE_URL = 'https://scqkpvmmoaolahpxinja.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcWtwdm1tb2FvbGFocHhpbmphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDIwNDksImV4cCI6MjA3MTE3ODA0OX0.Uz5L2SF8O1EGf_efkq5FLi6g1yl7LlmnTZi_eLnISMw';

    // FIX: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç Supabase —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const App = {
        state: {
            rideOffers: [],
            rideRequests: [],
            parcelRequests: [],
            userRole: null, 
            currentUser: null,
            selectedRoute: null, 
            toastTimeout: null,
            navigationHistory: ['main-screen'], // IMPROVE: –°—Ç–µ–∫ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        },

        init() {
            try { 
                Telegram.WebApp.ready(); 
                Telegram.WebApp.expand(); 
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –ª—É—á—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
                Telegram.WebApp.setHeaderColor('#ffffff');
                Telegram.WebApp.setBackgroundColor('#f8fafc');
                this.state.currentUser = Telegram.WebApp.initDataUnsafe?.user;
            } catch(e) { 
                console.warn("Telegram WebApp script not found or running in browser."); 
                // –î–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                this.state.currentUser = { id: 12345, first_name: '–¢–µ—Å—Ç', username: 'testuser' };
            }
            
            this.render.allScreens();
            this.bindEvents();
            this.setDefaultDates();
        },

        setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∫–∞–∫ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å –¥–∞—Ç–æ–π
            ['date-offer', 'date-request', 'date-parcel'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.setAttribute('min', today);
                    input.value = today;
                }
            });
        },
        
        bindEvents() {
            // –í—ã–±–æ—Ä —Ä–æ–ª–∏
            document.getElementById('role-selector').addEventListener('click', (e) => {
                const target = e.target.closest('.role-btn');
                if (!target) return;

                document.querySelectorAll('#role-selector .role-btn').forEach(btn => btn.classList.remove('active'));
                target.classList.add('active');
                this.state.userRole = target.dataset.role;
                document.getElementById('continue-btn').disabled = false;
            });

            // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏
            document.getElementById('continue-btn').addEventListener('click', () => {
                if (this.state.userRole) {
                    this.navigation.to('route-selection-screen', '–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
            document.getElementById('backButton').addEventListener('click', () => this.navigation.back());
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.body.addEventListener('click', (e) => {
                const target = e.target.closest('button');
                if (!target) return;

                const handlers = {
                    'select-route-koz-yo': this.handlers.onRouteSelect,
                    'view-driver-offers-btn': this.handlers.onViewDriverOffers,
                    'create-passenger-request-btn': () => this.navigation.to('passenger-request-screen', '–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–µ–∑–¥–∫—É'),
                    'send-parcel-btn': () => this.navigation.to('parcel-request-screen', '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É'),
                    'view-passenger-requests-btn': this.handlers.onViewPassengerRequests,
                    'publish-ride-btn': () => this.navigation.to('offer-screen', '–ù–æ–≤–∞—è –ø–æ–µ–∑–¥–∫–∞'),
                    'back-to-hub-btn': () => {
                        const screen = this.state.userRole === 'driver' ? 'driver-dashboard-screen' : 'passenger-home-screen';
                        const title = this.state.userRole === 'driver' ? '–ö–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è' : '–ü–∞—Å—Å–∞–∂–∏—Ä';
                        this.navigation.to(screen, title);
                    },
                };
                if (handlers[target.id]) handlers[target.id].call(this, e);
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –≤—Ä–µ–º–µ–Ω–∏
                if (target.closest('.direction-buttons')) this.handlers.onDirectionSelect.call(this, e);
                if (target.closest('#time-interval-buttons')) this.handlers.onTimeSelect.call(this, e);
            });

            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º
            document.body.addEventListener('submit', (e) => {
                e.preventDefault();
                const targetId = e.target.id;
                const handlers = {
                    'passenger-request-form': this.handlers.onPassengerRequestSubmit,
                    'parcel-request-form': this.handlers.onParcelRequestSubmit,
                    'offer-form': this.handlers.onOfferSubmit,
                };
                if (handlers[targetId]) handlers[targetId].call(this, e);
            });
        },

        handlers: {
            onRouteSelect(e) {
                const button = e.target.closest('button');
                if (!button) return;
                this.state.selectedRoute = {
                    from: button.dataset.from,
                    to: button.dataset.to
                };
                if (this.state.userRole === 'passenger') {
                    this.navigation.to('passenger-home-screen', '–ü–∞—Å—Å–∞–∂–∏—Ä');
                } else {
                    this.navigation.to('driver-dashboard-screen', '–ö–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è');
                }
            },
            onDirectionSelect(e) { 
                const button = e.target.closest('button'); 
                if (!button) return; 
                const form = button.closest('form'); 
                const errorEl = form.querySelector('.form-error-direction'); 
                if (errorEl) errorEl.classList.add('hidden'); 
                const container = button.parentElement; 
                container.querySelectorAll('button').forEach(btn => btn.classList.remove('active')); 
                button.classList.add('active'); 
                form.querySelector('input[name="from"]').value = button.dataset.from; 
                form.querySelector('input[name="to"]').value = button.dataset.to; 
            },
            onTimeSelect(e) {
                const button = e.target.closest('button');
                if (!button) return;
                const form = button.closest('form');
                const container = button.parentElement;
                container.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                form.querySelector('#timeIntervalInput').value = button.textContent;
                form.querySelector('.form-error-time').classList.add('hidden');
            },
            async onViewDriverOffers() { 
                const { data, error } = await supabaseClient.from('ride_offers').select('*').order('ride_date', { ascending: true }).order('ride_time', { ascending: true });
                if (error) { this.showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–µ–∑–¥–æ–∫', 'error'); console.error(error); return; }
                this.state.rideOffers = data;
                this.render.list(this.state.rideOffers, 'driverOffer'); 
                this.navigation.to('list-screen', '–ü–æ–µ–∑–¥–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π'); 
            },
            async onViewPassengerRequests() { 
                const { data: rides, error: ridesError } = await supabaseClient.from('ride_requests').select('*');
                const { data: parcels, error: parcelsError } = await supabaseClient.from('parcel_requests').select('*');
                
                if (ridesError || parcelsError) { this.showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫', 'error'); console.error(ridesError || parcelsError); return; }

                const allRequests = [...rides.map(r => ({...r, type: 'ride'})), ...parcels.map(p => ({...p, type: 'parcel'}))];
                allRequests.sort((a,b) => new Date(a.ride_date) - new Date(b.ride_date));
                
                this.render.list(allRequests, 'passengerRequest'); 
                this.navigation.to('list-screen', '–ó–∞—è–≤–∫–∏ –æ—Ç –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤'); 
            },
            async onPassengerRequestSubmit(e) { 
                const form = e.target; 
                const formData = new FormData(form); 
                let valid = true; 
                if (!formData.get('from')) { form.querySelector('.form-error-direction').classList.remove('hidden'); valid = false; } 
                if (!formData.get('timeInterval')) { form.querySelector('.form-error-time').classList.remove('hidden'); valid = false; }
                if (!formData.get('passengerName').trim()) { valid = false; this.showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è', 'error'); } 
                if (!valid) return; 
                
                const { error } = await supabaseClient.from('ride_requests').insert({
                    passenger_id: this.state.currentUser.id,
                    passenger_username: this.state.currentUser.username,
                    "from": formData.get('from'),
                    "to": formData.get('to'),
                    ride_date: formData.get('date'),
                    time_interval: formData.get('timeInterval'),
                    passenger_name: formData.get('passengerName'),
                    price: 600
                });

                if (error) { this.showToast('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏', 'error'); console.error(error); return; }
                
                this.resetForm(form); 
                this.render.success('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞', '–í–æ–¥–∏—Ç–µ–ª–∏ —Å–∫–æ—Ä–æ —É–≤–∏–¥—è—Ç –≤–∞—à—É –∑–∞—è–≤–∫—É.', '–û—Ç–ª–∏—á–Ω–æ'); 
            },
            async onParcelRequestSubmit(e) { 
                const form = e.target; 
                const formData = new FormData(form); 
                if (!formData.get('from')) { form.querySelector('.form-error-direction').classList.remove('hidden'); return; } 
                
                const { error } = await supabaseClient.from('parcel_requests').insert({
                    sender_id: this.state.currentUser.id,
                    sender_username: this.state.currentUser.username,
                    "from": formData.get('from'),
                    "to": formData.get('to'),
                    ride_date: formData.get('date'),
                    sender_name: this.state.currentUser.first_name || '–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å',
                    price: 300
                });

                if (error) { this.showToast('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏', 'error'); console.error(error); return; }

                this.resetForm(form); 
                this.render.success('–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ—Å—ã–ª–∫—É —Å–æ–∑–¥–∞–Ω–∞', '–í–æ–¥–∏—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –≤–∞—à—É –∑–∞—è–≤–∫—É.', '–û—Ç–ª–∏—á–Ω–æ'); 
            },
            async onOfferSubmit(e) { 
                const form = e.target; 
                const formData = new FormData(form); 
                if (!formData.get('from')) { form.querySelector('.form-error-direction').classList.remove('hidden'); return; } 
                if (!formData.get('driverName').trim() || !formData.get('driverCar').trim()) { this.showToast('–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ –º–∞—à–∏–Ω—É', 'error'); return; } 
                
                // NEW: –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
                const viaCheboksary = formData.get('via_cheboksary') === 'on';

                const { error } = await supabaseClient.from('ride_offers').insert({
                    driver_id: this.state.currentUser.id,
                    driver_username: this.state.currentUser.username,
                    "from": formData.get('from'),
                    "to": formData.get('to'),
                    ride_date: formData.get('date'),
                    ride_time: formData.get('time'),
                    seats: parseInt(formData.get('seats')),
                    price: 600,
                    driver_name: formData.get('driverName'),
                    driver_car: formData.get('driverCar'),
                    via_cheboksary: viaCheboksary // NEW: –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –±–∞–∑—É
                });

                if (error) { this.showToast('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏', 'error'); console.error(error); return; }
                
                this.resetForm(form); 
                this.render.success('–ü–æ–µ–∑–¥–∫–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞', '–ü–∞—Å—Å–∞–∂–∏—Ä—ã —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.', '–í –∫–∞–±–∏–Ω–µ—Ç'); 
            },
        },
        
        navigation: {
            to(screenId, title) {
                // –ü—Ä—è—á–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
                const targetScreen = document.getElementById(screenId);
                targetScreen.classList.add('active');
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                document.getElementById('headerTitle').textContent = title;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω
                if (this.state.navigationHistory[this.state.navigationHistory.length - 1] !== screenId) {
                    this.state.navigationHistory.push(screenId);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                document.getElementById('backButton').classList.toggle('invisible', this.state.navigationHistory.length <= 1);
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö
                if (screenId === 'passenger-request-screen' || screenId === 'offer-screen') {
                    App.render.populateUserData(screenId);
                }
                // –°–∫—Ä–æ–ª–ª –≤–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ —ç–∫—Ä–∞–Ω–∞
                document.getElementById('main-content').scrollTop = 0;
            },
            back() {
                // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
                this.state.navigationHistory.pop();
                // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–∫—Ä–∞–Ω
                const lastScreen = this.state.navigationHistory[this.state.navigationHistory.length - 1];
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç–∫—Ä–∞–Ω–∞
                // –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞, –≤ –±–æ–ª—å—à–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏
                let title = '–ü–æ–ø—É—Ç–∫–∞ 12';
                if (lastScreen !== 'main-screen') {
                    // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ ID —ç–∫—Ä–∞–Ω–∞
                    const titles = {
                        'route-selection-screen': '–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç',
                        'passenger-home-screen': '–ü–∞—Å—Å–∞–∂–∏—Ä',
                        'driver-dashboard-screen': '–ö–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è',
                        'list-screen': document.getElementById('headerTitle').textContent, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ø–∏—Å–∫–∞
                    };
                    title = titles[lastScreen] || '–ü–æ–ø—É—Ç–∫–∞ 12';
                }
                
                this.to(lastScreen, title);
            }
        },

        render: {
            // –®–∞–±–ª–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤
            allScreens() {
                const templates = {
                    'route-selection-screen': `<div class="text-center mb-8"><h2 class="text-2xl font-bold mb-1">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç</h2></div><div class="space-y-4"><button id="select-route-koz-yo" data-from="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" data-to="–ô–æ—à–∫–∞—Ä-–û–ª–∞" class="btn w-full bg-slate-800 text-white font-bold py-4 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫ &lt;‚Äî&gt; –ô–æ—à–∫–∞—Ä-–û–ª–∞</button></div>`,
                    'passenger-home-screen': `<div class="text-center mb-6"><h2 class="text-2xl font-bold mb-1">–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?</h2></div><div class="space-y-3"><button id="view-driver-offers-btn" class="btn w-full bg-slate-800 text-white font-bold py-4 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–µ–∑–¥–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π</button><button id="create-passenger-request-btn" class="btn w-full bg-slate-100 text-slate-800 font-bold py-4 px-4 rounded-xl hover:bg-slate-200">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–µ–∑–¥–∫—É</button><button id="send-parcel-btn" class="btn w-full bg-purple-100 text-purple-800 font-bold py-4 px-4 rounded-xl hover:bg-purple-200">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</button></div>`,
                    'driver-dashboard-screen': `<div class="text-center mb-6"><h2 class="text-2xl font-bold mb-1">–ö–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è</h2></div><div id="driver-dashboard-buttons" class="space-y-3"><button id="view-passenger-requests-btn" class="btn w-full bg-slate-800 text-white font-bold py-4 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">–°–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫–∏</button><button id="publish-ride-btn" class="btn w-full bg-slate-100 text-slate-800 font-bold py-4 px-4 rounded-xl hover:bg-slate-200">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–≤–æ—é –ø–æ–µ–∑–¥–∫—É</button></div>`,
                    // UPDATED: –î–æ–±–∞–≤–ª–µ–Ω —á–µ–∫–±–æ–∫—Å "–ß–µ—Ä–µ–∑ –ß–µ–±–æ–∫—Å–∞—Ä—ã"
                    'offer-screen': `<h2 class="text-xl font-bold mb-4">–î–∞–Ω–Ω—ã–µ –æ –ø–æ–µ–∑–¥–∫–µ</h2><form id="offer-form" class="space-y-4"><div><label class="block text-sm font-medium text-slate-600 mb-2">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label><div class="direction-buttons p-1 bg-slate-100 rounded-xl flex"><button type="button" data-from="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" data-to="–ô–æ—à–∫–∞—Ä-–û–ª–∞" class="role-btn btn flex-1 py-3 px-2 rounded-lg font-semibold text-slate-500 transition-colors text-center text-sm">–ö–ó–ú ‚Üí –ô–û</button><button type="button" data-from="–ô–æ—à–∫–∞—Ä-–û–ª–∞" data-to="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" class="role-btn btn flex-1 py-3 px-2 rounded-lg font-semibold text-slate-500 transition-colors text-center text-sm">–ô–û ‚Üí –ö–ó–ú</button></div><input type="hidden" name="from" required><input type="hidden" name="to" required><div class="form-error-direction text-red-500 text-sm text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div></div><div class="grid grid-cols-2 gap-4"><div><label for="date-offer" class="block text-sm font-medium text-slate-600 mb-2">–î–∞—Ç–∞</label><input type="date" name="date" id="date-offer" class="w-full p-3 border border-slate-200 rounded-lg" required></div><div><label for="time-offer" class="block text-sm font-medium text-slate-600 mb-2">–í—Ä–µ–º—è</label><input type="time" name="time" id="time-offer" class="w-full p-3 border border-slate-200 rounded-lg" required></div></div><div class="grid grid-cols-2 gap-4"><div><label for="driver-name" class="block text-sm font-medium text-slate-600 mb-2">–í–∞—à–µ –∏–º—è</label><input type="text" name="driverName" id="driver-name" class="w-full p-3 border border-slate-200 rounded-lg" placeholder="–ê–ª–µ–∫—Å–µ–π" required></div><div><label for="driver-car" class="block text-sm font-medium text-slate-600 mb-2">–ú–∞—Ä–∫–∞ –º–∞—à–∏–Ω—ã</label><input type="text" name="driverCar" id="driver-car" class="w-full p-3 border border-slate-200 rounded-lg" placeholder="Kia Rio" required></div></div><div><label class="block text-sm font-medium text-slate-600 mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç</label><input type="number" name="seats" min="1" max="8" class="w-full p-3 border border-slate-200 rounded-lg" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 3" required></div><div><label for="via-cheboksary" class="flex items-center space-x-3 cursor-pointer p-3 bg-slate-50 rounded-lg border border-slate-200"><input type="checkbox" name="via_cheboksary" id="via-cheboksary" class="h-4 w-4 rounded border-slate-300 text-slate-800 focus:ring-slate-600"><span class="text-slate-700 font-medium">–ß–µ—Ä–µ–∑ –ß–µ–±–æ–∫—Å–∞—Ä—ã <span class="text-slate-500 font-normal">(400 ‚ÇΩ)</span></span></label></div><button type="submit" class="btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å (600 ‚ÇΩ)</button></form>`,
                    'passenger-request-screen': `<h2 class="text-xl font-bold mb-4">–í–∞—à–∞ –∑–∞—è–≤–∫–∞</h2><form id="passenger-request-form" class="space-y-4"><div><label class="block text-sm font-medium text-slate-600 mb-2">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label><div class="direction-buttons p-1 bg-slate-100 rounded-xl flex"><button type="button" data-from="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" data-to="–ô–æ—à–∫–∞—Ä-–û–ª–∞" class="role-btn btn flex-1 py-3 px-2 rounded-lg font-semibold text-slate-500 transition-colors text-center text-sm">–ö–ó–ú ‚Üí –ô–û</button><button type="button" data-from="–ô–æ—à–∫–∞—Ä-–û–ª–∞" data-to="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" class="role-btn btn flex-1 py-3 px-2 rounded-lg font-semibold text-slate-500 transition-colors text-center text-sm">–ô–û ‚Üí –ö–ó–ú</button></div><input type="hidden" name="from" required><input type="hidden" name="to" required><div class="form-error-direction text-red-500 text-sm text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div></div><input type="date" name="date" id="date-request" class="w-full p-3 border border-slate-200 rounded-lg" required><div><label for="passenger-name" class="block text-sm font-medium text-slate-600 mb-2">–í–∞—à–µ –∏–º—è</label><input type="text" name="passengerName" id="passenger-name" class="w-full p-3 border border-slate-200 rounded-lg" placeholder="–ú–∞—Ä–∏—è" required></div><div><label class="block text-sm font-medium text-slate-600 mb-2">–ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–µ–∑–¥–∞</label><div id="time-interval-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-2"><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">04-06</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">06-08</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">08-10</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">10-12</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">12-14</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">14-16</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">16-18</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-sm">18-20</button></div><input type="hidden" name="timeInterval" id="timeIntervalInput" required><div class="form-error-time text-red-500 text-sm text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</div></div><button type="submit" class="btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button></form>`,
                    'parcel-request-screen': `<h2 class="text-xl font-bold mb-4">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</h2><form id="parcel-request-form" class="space-y-4"><div><label class="block text-sm font-medium text-slate-600 mb-2">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label><div class="direction-buttons p-1 bg-slate-100 rounded-xl flex"><button type="button" data-from="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" data-to="–ô–æ—à–∫–∞—Ä-–û–ª–∞" class="role-btn btn flex-1 py-3 px-2 rounded-lg font-semibold text-slate-500 transition-colors text-center text-sm">–ö–ó–ú ‚Üí –ô–û</button><button type="button" data-from="–ô–æ—à–∫–∞—Ä-–û–ª–∞" data-to="–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫" class="role-btn btn flex-1 py-3 px-2 rounded-lg font-semibold text-slate-500 transition-colors text-center text-sm">–ô–û ‚Üí –ö–ó–ú</button></div><input type="hidden" name="from" required><input type="hidden" name="to" required><div class="form-error-direction text-red-500 text-sm text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div></div><div><label for="date-parcel" class="block text-sm font-medium text-slate-600 mb-2">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</label><input type="date" name="date" id="date-parcel" class="w-full p-3 border border-slate-200 rounded-lg" required></div><div class="bg-slate-100 p-3 rounded-lg text-center text-slate-600">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏: <span class="font-bold">300 ‚ÇΩ</span></div><button type="submit" class="btn w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ—Å—ã–ª–∫—É</button></form>`,
                    'list-screen': `<div id="list-container" class="space-y-3"></div><div id="no-results" class="text-center text-slate-500 py-10 hidden"><h3 id="no-results-title" class="text-lg font-semibold"></h3><p id="no-results-text" class="text-sm"></p></div>`,
                    'success-screen': `<div class="flex flex-col items-center justify-center h-full text-center"><div class="mb-4"><svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h2 id="success-title" class="text-2xl font-bold mt-4 mb-1"></h2><p id="success-text" class="text-slate-600 mb-8"></p><button id="back-to-hub-btn" class="btn w-full max-w-xs bg-slate-800 text-white font-bold py-3 px-4 rounded-lg"></button></div>`,
                };
                for (const [id, html] of Object.entries(templates)) {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = html;
                }
            },
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–µ–∑–¥–æ–∫ –∏–ª–∏ –∑–∞—è–≤–æ–∫
            list(items, type) {
                const container = document.getElementById('list-container');
                const noResults = document.getElementById('no-results');
                container.innerHTML = '';

                if (!items || items.length === 0) {
                    noResults.classList.remove('hidden');
                    document.getElementById('no-results-title').textContent = type === 'driverOffer' ? '–ü–æ–µ–∑–¥–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ó–∞—è–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                    document.getElementById('no-results-text').textContent = type === 'driverOffer' ? '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –ø–æ–∑–∂–µ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ—é –∑–∞—è–≤–∫—É.' : '–ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏, –≤—ã –∏—Ö –∑–¥–µ—Å—å —É–≤–∏–¥–∏—Ç–µ.';
                    return;
                }
                noResults.classList.add('hidden');

                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'bg-white border border-slate-200 rounded-xl p-4 space-y-3';
                    let cardHTML = '';
                    
                    // UPDATED: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ item.via_cheboksary –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞—à–∫–∏
                    if (type === 'driverOffer') {
                        cardHTML = `
                            <div class="flex justify-between items-center">
                                <div class="font-bold text-lg">${item.from} ‚Üí ${item.to}</div>
                                <div class="text-lg font-semibold">${item.price} ‚ÇΩ</div>
                            </div>
                            <div class="text-slate-600">
                                <p><strong>–î–∞—Ç–∞:</strong> ${this.formatDate(item.ride_date)} –≤ <strong>${item.ride_time}</strong></p>
                                <p><strong>–í–æ–¥–∏—Ç–µ–ª—å:</strong> ${item.driver_name} –Ω–∞ ${item.driver_car}</p>
                                <p><strong>–°–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç:</strong> ${item.seats}</p>
                            </div>
                            ${item.via_cheboksary ? `<div class="pt-2 border-t border-slate-100"><p class="text-sm font-semibold text-indigo-600">üìç –ï–¥–µ—Ç —á–µ—Ä–µ–∑ –ß–µ–±–æ–∫—Å–∞—Ä—ã</p></div>` : ''}
                            <a href="https://t.me/${item.driver_username}" target="_blank" class="block w-full text-center bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors">–°–≤—è–∑–∞—Ç—å—Å—è —Å –≤–æ–¥–∏—Ç–µ–ª–µ–º</a>
                        `;
                    } else { // passengerRequest
                        const isParcel = item.type === 'parcel';
                        cardHTML = `
                            <div class="flex justify-between items-center">
                                <div class="font-bold text-lg">${item.from} ‚Üí ${item.to}</div>
                                <div class="text-lg font-semibold">${item.price} ‚ÇΩ</div>
                            </div>
                            <div class="text-slate-600">
                                <p><strong>–î–∞—Ç–∞:</strong> ${this.formatDate(item.ride_date)}</p>
                                <p><strong>${isParcel ? '–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å' : '–ü–∞—Å—Å–∞–∂–∏—Ä'}:</strong> ${isParcel ? item.sender_name : item.passenger_name}</p>
                                ${!isParcel ? `<p><strong>–í—Ä–µ–º—è:</strong> ${item.time_interval}</p>` : ''}
                            </div>
                            <div class="flex items-center gap-2">
                                ${isParcel ? `<div class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">–ü–æ—Å—ã–ª–∫–∞</div>` : `<div class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">–ü–∞—Å—Å–∞–∂–∏—Ä</div>`}
                            </div>
                            <a href="https://t.me/${isParcel ? item.sender_username : item.passenger_username}" target="_blank" class="block w-full text-center bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors">–°–≤—è–∑–∞—Ç—å—Å—è</a>
                        `;
                    }
                    card.innerHTML = cardHTML;
                    container.appendChild(card);
                });
            },
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ —É—Å–ø–µ—Ö–∞
            success(title, text, buttonText) {
                document.getElementById('success-title').textContent = title;
                document.getElementById('success-text').textContent = text;
                document.getElementById('back-to-hub-btn').textContent = buttonText;
                this.navigation.to('success-screen', '–£—Å–ø–µ—Ö');
            },
            // –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            populateUserData(screenId) {
                if (!App.state.currentUser) return;
                
                if (screenId === 'passenger-request-screen') {
                    const nameInput = document.getElementById('passenger-name');
                    if (nameInput) nameInput.value = App.state.currentUser.first_name || '';
                } else if (screenId === 'offer-screen') {
                    const nameInput = document.getElementById('driver-name');
                    if (nameInput) nameInput.value = App.state.currentUser.first_name || '';
                }
            },
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
            formatDate(dateString) {
                const date = new Date(dateString);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                if (date.toDateString() === today.toDateString()) return '–°–µ–≥–æ–¥–Ω—è';
                if (date.toDateString() === tomorrow.toDateString()) return '–ó–∞–≤—Ç—Ä–∞';
                
                return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            }
        },

        // –°–±—Ä–æ—Å –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        resetForm(form) {
            form.reset();
            this.setDefaultDates(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
            form.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
        },
        
        // –ü–æ–∫–∞–∑ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toast-message');
            
            messageEl.textContent = message;
            toast.className = 'toast fixed bottom-6 left-1/2 -translate-x-1/2 w-11/12 max-w-sm p-4 rounded-lg shadow-lg text-white text-center z-50'; // –°–±—Ä–æ—Å –∫–ª–∞—Å—Å–æ–≤
            toast.classList.add(type === 'error' ? 'bg-red-500' : 'bg-green-500');
            
            toast.classList.add('show');
            
            if (this.state.toastTimeout) clearTimeout(this.state.toastTimeout);
            
            this.state.toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
