<!DOCTYPE html>

<html lang="ru">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">

Â  Â  <title>ĞŸĞ¾Ğ¿ÑƒÑ‚ĞºĞ° 12</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>

Â  Â  <style>

Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;

Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;

Â  Â  Â  Â  Â  Â  overscroll-behavior-y: contain;

Â  Â  Â  Â  }

Â  Â  Â  Â  .screen { display: none; animation: fadeIn 0.3s ease-in-out; }

Â  Â  Â  Â  .screen.active { display: block; }

Â  Â  Â  Â  #chat-screen.active, #my-trips-screen.active { display: flex; flex-direction: column; height: 100%; }



Â  Â  Â  Â  @keyframes fadeIn {

Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: translateY(5px); }

Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }

Â  Â  Â  Â  }

Â  Â  Â  Â  .role-btn.active, .direction-buttons button.active, #time-interval-buttons button.active {

Â  Â  Â  Â  Â  Â  background-color: #1e293b; /* slate-800 */

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  }

Â  Â  Â  Â  .message { max-width: 75%; word-wrap: break-word; }

Â  Â  Â  Â  .message.sent { align-self: flex-end; background-color: #3b82f6; color: white; } /* blue-500 */

Â  Â  Â  Â  .message.received { align-self: flex-start; background-color: #e5e7eb; color: #1f2937; } /* gray-200 */

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Role Switcher Styles */

Â  Â  Â  Â  #role-switcher {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  }

Â  Â  Â  Â  #role-bg {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  width: 36px; height: 36px;

Â  Â  Â  Â  Â  Â  top: 2px;

Â  Â  Â  Â  Â  Â  left: 2px;

Â  Â  Â  Â  Â  Â  background-color: white;

Â  Â  Â  Â  Â  Â  border-radius: 9999px;

Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

Â  Â  Â  Â  Â  Â  transform: translateX(0px);

Â  Â  Â  Â  Â  Â  transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);

Â  Â  Â  Â  }

Â  Â  Â  Â  #role-switcher.driver #role-bg {

Â  Â  Â  Â  Â  Â  transform: translateX(36px);

Â  Â  Â  Â  }

Â  Â  Â  Â  #role-passenger-icon, #role-driver-icon {

Â  Â  Â  Â  Â  Â  transition: opacity 0.3s ease-in-out;

Â  Â  Â  Â  }

Â  Â  Â  Â  #role-passenger-icon span, #role-driver-icon span {

Â  Â  Â  Â  Â  Â  display: inline-block;

Â  Â  Â  Â  Â  Â  transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);

Â  Â  Â  Â  }

Â  Â  Â  Â  #role-switcher.passenger #role-passenger-icon span,

Â  Â  Â  Â  #role-switcher.driver #role-driver-icon span {

Â  Â  Â  Â  Â  Â  transform: scale(1.15) rotate(-8deg);

Â  Â  Â  Â  }

Â  Â  Â  Â  #role-switcher.passenger #role-driver-icon,

Â  Â  Â  Â  #role-switcher.driver #role-passenger-icon {

Â  Â  Â  Â  Â  Â  opacity: 0.5;

Â  Â  Â  Â  }

Â  Â  Â  Â  #profile-avatar-btn img {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  object-fit: cover;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Modal Styles */

Â  Â  Â  Â  .modal-overlay {

Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  transition: opacity 0.3s ease-in-out;

Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-overlay.show {

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â  .modal.show {

Â  Â  Â  Â  Â  Â  transform: translateY(0);

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Filter Button Styles */

Â  Â  Â  Â  .filter-type-btn.active {

Â  Â  Â  Â  Â  Â  background-color: white;

Â  Â  Â  Â  Â  Â  color: #1e293b;

Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Collapsible Filter Styles */

Â  Â  Â  Â  #filter-toggle-icon {

Â  Â  Â  Â  Â  Â  transition: transform 0.3s ease-in-out;

Â  Â  Â  Â  }

Â  Â  Â  Â  #filter-content {

Â  Â  Â  Â  Â  Â  max-height: 500px;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â  #filter-content.collapsed {

Â  Â  Â  Â  Â  Â  max-height: 0;

Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  }

Â  Â  Â  Â  #filter-toggle-btn.collapsed #filter-toggle-icon {

Â  Â  Â  Â  Â  Â  transform: rotate(-180deg);

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Custom scrollbar for better look */

Â  Â  Â  Â  #main-content::-webkit-scrollbar { width: 4px; }

Â  Â  Â  Â  #main-content::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }

Â  Â  Â  Â  #main-content::-webkit-scrollbar-track { background: transparent; }

Â  Â  </style>

</head>

<body class="bg-slate-50 text-slate-800 overflow-hidden">



Â  Â  <div id="app-container" class="h-screen w-screen max-w-md mx-auto bg-white flex flex-col">

Â  Â  Â  Â  <header id="app-header" class="p-4 flex items-center justify-between bg-white border-b border-slate-200 flex-shrink-0 sticky top-0 z-10">

Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 flex items-center justify-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="backButton" class="text-slate-500 hover:text-slate-800 transition-colors invisible">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>

Â  Â  Â  Â  Â  Â  Â  Â  Â </button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <h1 id="headerTitle" class="text-base font-semibold text-slate-800 text-center flex-grow">ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€</h1>

Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="role-switcher" class="flex items-center p-1 bg-slate-100 rounded-full cursor-pointer">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="role-bg"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="role-passenger-icon" class="relative z-10 w-9 h-9 flex items-center justify-center text-xl">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>ğŸ§</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="role-driver-icon" class="relative z-10 w-9 h-9 flex items-center justify-center text-xl">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span>ğŸš—</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â <button id="profile-avatar-btn" class="w-10 h-10 rounded-full bg-slate-200 text-slate-600 font-semibold flex items-center justify-center overflow-hidden shrink-0">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <!-- Avatar will be rendered here by JS -->

Â  Â  Â  Â  Â  Â  Â  Â  Â </button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </header>



Â  Â  Â  Â  <main id="main-content" class="flex-grow overflow-y-auto relative">

Â  Â  Â  Â  Â  Â  <!-- Screens will be rendered here by JS -->

Â  Â  Â  Â  Â  Â  <div id="passenger-home-screen" class="screen active"></div>

Â  Â  Â  Â  Â  Â  <div id="driver-dashboard-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="offer-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="passenger-request-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="parcel-request-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="list-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="success-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="chat-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="my-trips-screen" class="screen"></div>

Â  Â  Â  Â  Â  Â  <div id="profile-screen" class="screen"></div>

Â  Â  Â  Â  </main>

Â  Â  Â  Â Â 

Â  Â  Â  Â  <!-- App Footer -->

Â  Â  Â  Â  <footer id="app-footer" class="p-5 border-t border-slate-200 bg-white flex-shrink-0">

Â  Â  Â  Â  Â  Â  <a href="https://t.me/poputka12rus" target="_blank" class="text-sm btn w-full bg-sky-100 text-sky-800 font-bold py-3 px-4 rounded-xl hover:bg-sky-200 flex items-center justify-center gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>

Â  Â  Â  Â  Â  Â  Â  Â  <span>ĞĞ°ÑˆĞ° Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ° Ğ² Telegram</span>

Â  Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  Â  Â  <a href="https://devtol.ru" target="_blank" class="block text-center text-xs text-slate-400 mt-2 hover:underline">

Â  Â  Â  Â  Â  Â  Â  Â  powered by devtol

Â  Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  </footer>

Â  Â  </div>



Â  Â  <!-- Booking Options Modal -->

Â  Â  <div id="booking-modal-overlay" class="modal-overlay fixed inset-0 bg-black bg-opacity-40 z-40 hidden"></div>

Â  Â  <div id="booking-modal" class="modal fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto bg-transparent z-50 transform translate-y-full transition-transform duration-300">

Â  Â  Â  Â  <div class="p-4">

Â  Â  Â  Â  Â  Â  <div id="booking-options-container" class="space-y-2 bg-slate-100 rounded-xl">

Â  Â  Â  Â  Â  Â  Â  Â  <!-- Booking options will be rendered here by JS -->

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button id="booking-modal-cancel-btn" class="w-full p-3 mt-2 bg-white rounded-xl text-blue-500 text-lg font-semibold">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>

Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â Â 

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

Â  Â  <script>

Â  Â  // --- Ğ’ĞĞ–ĞĞ: ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ‘ĞĞ—Ğ« Ğ”ĞĞĞĞ«Ğ¥ ---

Â  Â  // Ğ”Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ° Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ² Supabase:

Â  Â  // 1. Ğ’ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `ride_requests`:

Â  Â  //Â  Â  - Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ `status` (Ñ‚Ğ¸Ğ¿ `text`, Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ `'open'`).

Â  Â  //Â  Â  Â  ĞĞ½Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ·Ğ°ÑĞ²ĞºĞ¸: 'open', 'pending_confirmation', 'closed'.

Â  Â  // 2. Ğ’ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `ride_offers`:

Â  Â  //Â  Â  - Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ `linked_request_id` (Ñ‚Ğ¸Ğ¿ `uuid` Ğ¸Ğ»Ğ¸ `bigint`, Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ° id Ğ² `ride_requests`).

Â  Â  //Â  Â  Â  Ğ­Ñ‚Ğ° ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ° Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ·Ğ°ÑĞ²ĞºĞ¾Ğ¹ Ğ¿Ğ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ğ°.

Â  Â  // --- ĞšĞĞĞ•Ğ¦ Ğ˜ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ˜Ğ˜ ---



Â  Â  // --- SUPABASE CLIENT INITIALIZATION ---

Â  Â  const SUPABASE_URL = 'https://scqkpvmmoaolahpxinja.supabase.co';

Â  Â  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcWtwdm1tb2FvbGFocHhpbmphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDIwNDksImV4cCI6MjA3MTE3ODA0OX0.Uz5L2SF8O1EGf_efkq5FLi6g1yl7LlmnTZi_eLnISMw';

Â  Â  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);



Â  Â  // --- APPLICATION LOGIC ---

Â  Â  const App = {

Â  Â  Â  Â  // --- STATE MANAGEMENT ---

Â  Â  Â  Â  state: {

Â  Â  Â  Â  Â  Â  currentUser: null,

Â  Â  Â  Â  Â  Â  userProfile: null,

Â  Â  Â  Â  Â  Â  userRole: 'passenger', // Default role

Â  Â  Â  Â  Â  Â  selectedRoute: null,

Â  Â  Â  Â  Â  Â  navigationHistory: ['passenger-home-screen'], // New default screen

Â  Â  Â  Â  Â  Â  allRequests: [], // To store the fetched requests

Â  Â  Â  Â  Â  Â  currentFilters: { // To store the current filter values

Â  Â  Â  Â  Â  Â  Â  Â  from: '',

Â  Â  Â  Â  Â  Â  Â  Â  to: '',

Â  Â  Â  Â  Â  Â  Â  Â  date: '',

Â  Â  Â  Â  Â  Â  Â  Â  type: 'all' // 'all', 'ride', 'parcel'

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  currentConversation: {

Â  Â  Â  Â  Â  Â  Â  Â  id: null,

Â  Â  Â  Â  Â  Â  Â  Â  subscription: null

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- CONFIGURATION ---

Â  Â  Â  Â  config: {

Â  Â  Â  Â  Â  Â  botToken: '8202443902:AAEMonQpK3FmOAh5Up4GPBmI89q1mHz8LpY',

Â  Â  Â  Â  Â  Â  prices: {

Â  Â  Â  Â  Â  Â  Â  Â  base: 600,

Â  Â  Â  Â  Â  Â  Â  Â  parcel: 300,

Â  Â  Â  Â  Â  Â  Â  Â  cheboksary: 400,

Â  Â  Â  Â  Â  Â  Â  Â  ferrySurcharge: 100

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  routes: {

Â  Â  Â  Â  Â  Â  Â  Â  koz_yo: { from: 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº', to: 'Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°' }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  cities: ['Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°', 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹', 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº'],

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- INITIALIZATION ---

Â  Â  Â  Â  async init() {

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.ready();

Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.expand();

Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.setHeaderColor('#ffffff');

Â  Â  Â  Â  Â  Â  Â  Â  Telegram.WebApp.setBackgroundColor('#f8fafc');

Â  Â  Â  Â  Â  Â  Â  Â  this.state.currentUser = Telegram.WebApp.initDataUnsafe?.user;

Â  Â  Â  Â  Â  Â  } catch (e) {

Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Telegram WebApp script not found or running in browser.");

Â  Â  Â  Â  Â  Â  Â  Â  this.state.currentUser = { id: 12345678, first_name: 'Ğ¢ĞµÑÑ‚', username: 'testuser' };

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  if (this.state.currentUser) {

Â  Â  Â  Â  Â  Â  Â  Â  await this.ensureUserProfile();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  this.bindHandlers();

Â  Â  Â  Â  Â  Â  this.render.allScreens();

Â  Â  Â  Â  Â  Â  this.render.updateRoleSwitcherUI();

Â  Â  Â  Â  Â  Â  this.bindEvents();

Â  Â  Â  Â  Â  Â  this.setDefaultDates();

Â  Â  Â  Â  Â  Â  this.render.updateAvatar();

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- USER PROFILE ---

Â  Â  Â  Â  async ensureUserProfile() {

Â  Â  Â  Â  Â  Â  if (!this.state.currentUser) return;



Â  Â  Â  Â  Â  Â  let { data: profile, error: fetchError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  .from('profiles')

Â  Â  Â  Â  Â  Â  Â  Â  .select('*')

Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', this.state.currentUser.id)

Â  Â  Â  Â  Â  Â  Â  Â  .single();



Â  Â  Â  Â  Â  Â  if (fetchError && fetchError.code === 'PGRST116') {

Â  Â  Â  Â  Â  Â  Â  Â  const { data: newProfile, error: insertError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('profiles')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: this.state.currentUser.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  username: this.state.currentUser.username,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  full_name: this.state.currentUser.first_name || 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ'

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();



Â  Â  Â  Â  Â  Â  Â  Â  if (insertError) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error creating user profile:', insertError);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  profile = newProfile;

Â  Â  Â  Â  Â  Â  } else if (fetchError) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching user profile:', fetchError);

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  this.state.userProfile = profile;

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- HANDLER BINDING ---

Â  Â  Â  Â  bindHandlers() {

Â  Â  Â  Â  Â  Â  for (const key in this.handlers) {

Â  Â  Â  Â  Â  Â  Â  Â  if (typeof this.handlers[key] === 'function') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers[key] = this.handlers[key].bind(this);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- EVENT BINDING ---

Â  Â  Â  Â  bindEvents() {

Â  Â  Â  Â  Â  Â  document.body.addEventListener('click', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  const button = e.target.closest('button, #role-switcher, #booking-modal-overlay');

Â  Â  Â  Â  Â  Â  Â  Â  if (!button) return;



Â  Â  Â  Â  Â  Â  Â  Â  const { id, classList, dataset } = button;



Â  Â  Â  Â  Â  Â  Â  Â  if (id === 'role-switcher') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onRoleSwitch();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (button.closest('#time-interval-buttons')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onTimeSelect(button);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if (button.classList.contains('filter-type-btn')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onFilterTypeSelect(button);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const clickHandlers = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'backButton': () => this.navigation.back(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'view-driver-offers-btn': this.handlers.onViewDriverOffers,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'create-passenger-request-btn': () => this.navigation.to('passenger-request-screen', 'Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ'),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'send-parcel-btn': () => this.navigation.to('parcel-request-screen', 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ'),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'view-passenger-requests-btn': this.handlers.onViewPassengerRequests,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'publish-ride-btn': this.handlers.onPublishRideClick,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'my-trips-btn': this.handlers.onMyTripsClick,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'back-to-hub-btn': this.handlers.onBackToHub,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'profile-avatar-btn': () => this.navigation.to('profile-screen', 'ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'booking-modal-cancel-btn': this.handlers.onBookingModalCancel,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'booking-modal-overlay': this.handlers.onBookingModalCancel,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'apply-filters-btn': this.handlers.onApplyFilters,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'reset-filters-btn': this.handlers.onResetFilters,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'filter-toggle-btn': this.handlers.onToggleFilter,

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  if (clickHandlers[id]) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clickHandlers[id]();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('offer-ride-btn')) this.handlers.onOfferRideToRequest(dataset.requestId);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('request-booking-btn')) this.handlers.onRequestBooking(dataset.offerId);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('detour-booking-btn')) this.handlers.onDetourBookingClick(dataset.offer);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('confirm-booking-segment-btn')) this.handlers.onConfirmBookingSegment(dataset);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('cancel-booking-btn')) this.handlers.onCancelBooking(dataset.bookingId);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('accept-booking-btn')) this.handlers.onUpdateBookingStatus(dataset.bookingId, 'confirmed');

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('reject-booking-btn')) this.handlers.onUpdateBookingStatus(dataset.bookingId, 'rejected');

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('delete-offer-btn')) this.handlers.onDeleteOffer(dataset.offerId);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('cancel-request-btn')) this.handlers.onCancelRequest(dataset.requestId);

Â  Â  Â  Â  Â  Â  Â  Â  if (classList.contains('cancel-parcel-request-btn')) this.handlers.onCancelParcelRequest(dataset.requestId);

Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  document.body.addEventListener('submit', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  Â  Â  Â  Â  const formHandlers = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'passenger-request-form': () => this.handlers.onPassengerRequestSubmit(e.target),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'parcel-request-form': () => this.handlers.onParcelRequestSubmit(e.target),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'offer-form': () => this.handlers.onOfferSubmit(e.target),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'chat-form': () => this.handlers.onSendMessage(e.target),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'profile-form': () => this.handlers.onProfileSubmit(e.target),

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  if (formHandlers[e.target.id]) formHandlers[e.target.id]();

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  document.body.addEventListener('change', (e) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.id === 'via-ferry-toggle' || e.target.id === 'via-cheboksary-detour-toggle') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onRouteOptionChange(e.target);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.name === 'from-select' || e.target.name === 'to-select') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onRouteDropdownChange(e.target);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- ACTION HANDLERS ---

Â  Â  Â  Â  handlers: {

Â  Â  Â  Â  Â  Â  onRoleSwitch() {

Â  Â  Â  Â  Â  Â  Â  Â  this.state.userRole = this.state.userRole === 'passenger' ? 'driver' : 'passenger';

Â  Â  Â  Â  Â  Â  Â  Â  this.render.updateRoleSwitcherUI();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const newScreen = this.state.userRole === 'passenger' ? 'passenger-home-screen' : 'driver-dashboard-screen';

Â  Â  Â  Â  Â  Â  Â  Â  const newTitle = this.state.userRole === 'passenger' ? 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€' : 'ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ';

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  this.state.navigationHistory = [newScreen];

Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to(newScreen, newTitle);

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onToggleFilter() {

Â  Â  Â  Â  Â  Â  Â  Â  const content = document.getElementById('filter-content');

Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('filter-toggle-btn');

Â  Â  Â  Â  Â  Â  Â  Â  content.classList.toggle('collapsed');

Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('collapsed');

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onRouteOptionChange(checkbox) {

Â  Â  Â  Â  Â  Â  Â  Â  const form = checkbox.closest('form');

Â  Â  Â  Â  Â  Â  Â  Â  const ferryToggle = form.querySelector('#via-ferry-toggle');

Â  Â  Â  Â  Â  Â  Â  Â  const detourToggle = form.querySelector('#via-cheboksary-detour-toggle');



Â  Â  Â  Â  Â  Â  Â  Â  if (checkbox.id === 'via-ferry-toggle' && checkbox.checked) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  detourToggle.checked = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#cheboksary-detour-container').classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onRouteDropdownChange(form.querySelector('select'));

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onRouteDropdownChange(selectElement) {

Â  Â  Â  Â  Â  Â  Â  Â  const form = selectElement.closest('form');

Â  Â  Â  Â  Â  Â  Â  Â  const fromSelect = form.querySelector('select[name="from-select"]');

Â  Â  Â  Â  Â  Â  Â  Â  const toSelect = form.querySelector('select[name="to-select"]');

Â  Â  Â  Â  Â  Â  Â  Â  const fromValue = fromSelect.value;

Â  Â  Â  Â  Â  Â  Â  Â  const toValue = toSelect.value;



Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('input[name="from"]').value = fromValue;

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('input[name="to"]').value = toValue;



Â  Â  Â  Â  Â  Â  Â  Â  Array.from(toSelect.options).forEach(opt => { opt.disabled = opt.value === fromValue; });

Â  Â  Â  Â  Â  Â  Â  Â  Array.from(fromSelect.options).forEach(opt => { opt.disabled = opt.value === toValue; });



Â  Â  Â  Â  Â  Â  Â  Â  const isKozYoRoute = (fromValue === 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº' && toValue === 'Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°') || (fromValue === 'Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°' && toValue === 'ĞšĞ¾Ğ·ÑŒĞ¼Ğ¾Ğ´ĞµĞ¼ÑŒÑĞ½ÑĞº');

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const ferryContainer = form.querySelector('#ferry-toggle-container');

Â  Â  Â  Â  Â  Â  Â  Â  const detourContainer = form.querySelector('#cheboksary-detour-container');

Â  Â  Â  Â  Â  Â  Â  Â  const ferryToggle = form.querySelector('#via-ferry-toggle');



Â  Â  Â  Â  Â  Â  Â  Â  if (isKozYoRoute) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ferryContainer.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!ferryToggle.checked) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  detourContainer.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  detourContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ferryContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ferryToggle.checked = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  detourContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#via-cheboksary-detour-toggle').checked = false;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  this.render.updateOfferOptionsUI(form);



Â  Â  Â  Â  Â  Â  Â  Â  if (fromValue && toValue) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-direction').classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  onTimeSelect(button) {

Â  Â  Â  Â  Â  Â  Â  Â  const form = button.closest('form');

Â  Â  Â  Â  Â  Â  Â  Â  button.parentElement.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#timeIntervalInput').value = button.textContent;

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-time').classList.add('hidden');

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  onPublishRideClick() {

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.state.userProfile?.driver_car || !this.state.userProfile.driver_car.trim()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Driver car info missing');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('profile-screen', 'ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('offer-screen', 'ĞĞ¾Ğ²Ğ°Ñ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ°');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  async onViewDriverOffers() {

Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('list-screen', 'ĞŸĞ¾ĞµĞ·Ğ´ĞºĞ¸ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹');

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-section-container').classList.add('hidden');



Â  Â  Â  Â  Â  Â  Â  Â  const { data: offers, error: offersError } = await supabaseClient.from('ride_offers_with_seats')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', new Date().toISOString().split('T')[0])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gt('seats_left', 0)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_date', { ascending: true })

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_time', { ascending: true });



Â  Â  Â  Â  Â  Â  Â  Â  if (offersError) { console.error(offersError); return; }



Â  Â  Â  Â  Â  Â  Â  Â  const { data: userBookings, error: bookingsError } = await supabaseClient.from('bookings')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('id, offer_id')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('passenger_id', this.state.currentUser.id);



Â  Â  Â  Â  Â  Â  Â  Â  if (bookingsError) { console.error("Error fetching user bookings:", bookingsError); }



Â  Â  Â  Â  Â  Â  Â  Â  const userBookingsMap = new Map();

Â  Â  Â  Â  Â  Â  Â  Â  if (userBookings) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userBookings.forEach(b => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userBookingsMap.set(b.offer_id, b.id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const augmentedOffers = offers.map(offer => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...offer,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUserBookingId: userBookingsMap.get(offer.id) || null

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  this.render.list(augmentedOffers, 'driverOffer');

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  async onViewPassengerRequests() {

Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('list-screen', 'Ğ—Ğ°ÑĞ²ĞºĞ¸ Ğ¾Ñ‚ Ğ¿Ğ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²');

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-section-container').classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  if (this.state.userRole === 'driver') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-type-container').classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-type-container').classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const listContainer = document.getElementById('list-container');

Â  Â  Â  Â  Â  Â  Â  Â  listContainer.innerHTML = `<div class="text-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-slate-800 mx-auto"></div></div>`;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];

Â  Â  Â  Â  Â  Â  Â  Â  const dateFilterInput = document.getElementById('filter-date');

Â  Â  Â  Â  Â  Â  Â  Â  if (dateFilterInput) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dateFilterInput.setAttribute('min', today);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { data: rides, error: ridesError } = await supabaseClient.from('ride_requests')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', today)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('status', 'open')Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_date', { ascending: true });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const { data: parcels, error: parcelsError } = await supabaseClient.from('parcel_requests')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*').gte('ride_date', today).order('ride_date', { ascending: true });



Â  Â  Â  Â  Â  Â  Â  Â  if (ridesError || parcelsError) { console.error(ridesError || parcelsError); return; }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const allRequests = [

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...rides.map(r => ({...r, type: 'ride'})),Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...parcels.map(p => ({...p, type: 'parcel'}))

Â  Â  Â  Â  Â  Â  Â  Â  ];

Â  Â  Â  Â  Â  Â  Â  Â  allRequests.sort((a, b) => new Date(a.ride_date) - new Date(b.ride_date));

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  this.state.allRequests = allRequests;

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onResetFilters();

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onFilterTypeSelect(button) {

Â  Â  Â  Â  Â  Â  Â  Â  button.parentElement.querySelectorAll('.filter-type-btn').forEach(btn => btn.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onApplyFilters() {

Â  Â  Â  Â  Â  Â  Â  Â  const from = document.getElementById('filter-from').value;

Â  Â  Â  Â  Â  Â  Â  Â  const to = document.getElementById('filter-to').value;

Â  Â  Â  Â  Â  Â  Â  Â  const date = document.getElementById('filter-date').value;

Â  Â  Â  Â  Â  Â  Â  Â  const type = document.querySelector('#filter-type-buttons .active').dataset.type;



Â  Â  Â  Â  Â  Â  Â  Â  this.state.currentFilters = { from, to, date, type };

Â  Â  Â  Â  Â  Â  Â  Â  this.renderFilteredList();

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onResetFilters() {

Â  Â  Â  Â  Â  Â  Â  Â  this.state.currentFilters = { from: '', to: '', date: '', type: 'all' };



Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-from').value = '';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-to').value = '';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('filter-date').value = '';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('#filter-type-buttons .filter-type-btn').forEach(btn => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('active', btn.dataset.type === 'all');

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  this.renderFilteredList();

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onMyTripsClick() {

Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('my-trips-screen', 'ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸');

Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('my-trips-container');

Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<div class="text-center p-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-slate-800 mx-auto"></div></div>`;



Â  Â  Â  Â  Â  Â  Â  Â  if (this.state.userRole === 'driver') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: offers, error } = await supabaseClient.from('ride_offers')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select(`*, bookings(*, profiles(full_name, username))`)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('driver_id', this.state.currentUser.id)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', new Date().toISOString().split('T')[0])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('ride_date', { ascending: true });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); return; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.render.myTrips(offers, 'driver');

Â  Â  Â  Â  Â  Â  Â  Â  } else { // Passenger

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: bookings, error: bookingsError } = await supabaseClient.from('bookings')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select(`*, ride_offers(*)`)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('passenger_id', this.state.currentUser.id)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_offers.ride_date', new Date().toISOString().split('T')[0])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('created_at', { ascending: false });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: requests, error: requestsError } = await supabaseClient.from('ride_requests')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select(`*`)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('passenger_id', this.state.currentUser.id)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .in('status', ['open', 'pending_confirmation'])Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', new Date().toISOString().split('T')[0])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('created_at', { ascending: false });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { data: parcels, error: parcelsError } = await supabaseClient.from('parcel_requests')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select(`*`)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('sender_id', this.state.currentUser.id)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .gte('ride_date', new Date().toISOString().split('T')[0])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('created_at', { ascending: false });



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (bookingsError || requestsError || parcelsError) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(bookingsError || requestsError || parcelsError);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.render.myTrips({ bookings, requests, parcels }, 'passenger');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onOfferSubmit(form) {

Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);

Â  Â  Â  Â  Â  Â  Â  Â  const from = formData.get('from');

Â  Â  Â  Â  Â  Â  Â  Â  const to = formData.get('to');



Â  Â  Â  Â  Â  Â  Â  Â  if (!from || !to) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-direction').classList.remove('hidden');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.state.userProfile.full_name || !this.state.userProfile.driver_car) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Profile info missing');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const viaFerry = form.querySelector('#via-ferry-toggle').checked;

Â  Â  Â  Â  Â  Â  Â  Â  const viaCheboksaryDetour = form.querySelector('#via-cheboksary-detour-toggle').checked;

Â  Â  Â  Â  Â  Â  Â  Â  const isCheboksaryRoute = from === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹' || to === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹';

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let finalPrice = this.config.prices.base;

Â  Â  Â  Â  Â  Â  Â  Â  if (isCheboksaryRoute) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalPrice = this.config.prices.cheboksary;

Â  Â  Â  Â  Â  Â  Â  Â  } else if (viaFerry) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalPrice += this.config.prices.ferrySurcharge;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('ride_offers').insert({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_id: this.state.currentUser.id, driver_username: this.state.currentUser.username,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "from": from, "to": to, ride_date: formData.get('date'),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_time: formData.get('time'), seats: parseInt(formData.get('seats')),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: finalPrice, driver_name: this.state.userProfile.full_name, driver_car: this.state.userProfile.driver_car,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  via_cheboksary: isCheboksaryRoute,Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  via_ferry: !isCheboksaryRoute && viaFerry,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  via_cheboksary_detour: !isCheboksaryRoute && !viaFerry && viaCheboksaryDetour

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); return; }

Â  Â  Â  Â  Â  Â  Â  Â  this.resetForm(form);

Â  Â  Â  Â  Â  Â  Â  Â  this.render.success('ĞŸĞ¾ĞµĞ·Ğ´ĞºĞ° Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ°', 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ñ‹ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ²Ğ°ÑˆĞµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ.', 'Ğ’ ĞºĞ°Ğ±Ğ¸Ğ½ĞµÑ‚');

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  async onPassengerRequestSubmit(form) {

Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);

Â  Â  Â  Â  Â  Â  Â  Â  const from = formData.get('from');

Â  Â  Â  Â  Â  Â  Â  Â  const to = formData.get('to');

Â  Â  Â  Â  Â  Â  Â  Â  let valid = true;



Â  Â  Â  Â  Â  Â  Â  Â  if (!from || !to) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-direction').classList.remove('hidden');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  valid = false;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (!formData.get('timeInterval')) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-time').classList.remove('hidden');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  valid = false;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (!valid) return;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const isCheboksaryRoute = from === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹' || to === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹';

Â  Â  Â  Â  Â  Â  Â  Â  const price = isCheboksaryRoute ? this.config.prices.cheboksary : this.config.prices.base;



Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('ride_requests').insert({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  passenger_id: this.state.currentUser.id, passenger_username: this.state.currentUser.username,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "from": from, "to": to, ride_date: formData.get('date'),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time_interval: formData.get('timeInterval'), passenger_name: this.state.userProfile.full_name, price: price,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'open'

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); return; }

Â  Â  Â  Â  Â  Â  Â  Â  this.resetForm(form);

Â  Â  Â  Â  Â  Â  Â  Â  this.render.success('Ğ—Ğ°ÑĞ²ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°', 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ ÑĞºĞ¾Ñ€Ğ¾ ÑƒĞ²Ğ¸Ğ´ÑÑ‚ Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ.', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾');

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onParcelRequestSubmit(form) {

Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);

Â  Â  Â  Â  Â  Â  Â  Â  const from = formData.get('from');

Â  Â  Â  Â  Â  Â  Â  Â  const to = formData.get('to');

Â  Â  Â  Â  Â  Â  Â  Â  if (!from || !to) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('.form-error-direction').classList.remove('hidden');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('parcel_requests').insert({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sender_id: this.state.currentUser.id, sender_username: this.state.currentUser.username,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "from": from, "to": to, ride_date: formData.get('date'),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sender_name: this.state.userProfile.full_name, price: this.config.prices.parcel

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error(error); return; }

Â  Â  Â  Â  Â  Â  Â  Â  this.resetForm(form);

Â  Â  Â  Â  Â  Â  Â  Â  this.render.success('Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğ° Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°', 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸ ÑƒĞ²Ğ¸Ğ´ÑÑ‚ Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ.', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾');

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onProfileSubmit(form) {

Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData(form);

Â  Â  Â  Â  Â  Â  Â  Â  const fullName = formData.get('fullName').trim();

Â  Â  Â  Â  Â  Â  Â  Â  const driverCar = formData.get('driverCar').trim();

Â  Â  Â  Â  Â  Â  Â  Â  if (!fullName) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Full name is required');Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { data, error } = await supabaseClient.from('profiles')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .update({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  full_name: fullName,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_car: driverCar

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', this.state.currentUser.id)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();



Â  Â  Â  Â  Â  Â  Â  Â  if (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Profile save error:', error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  this.state.userProfile = data;

Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.back();

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onRequestBooking(offerId, bookingDetails = null) {

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.state.userProfile) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Profile not loaded');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const { data: existingBooking } = await supabaseClient.from('bookings')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('id').eq('offer_id', offerId).eq('passenger_id', this.state.currentUser.id);

Â  Â  Â  Â  Â  Â  Â  Â  if (existingBooking && existingBooking.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn('Booking already exists'); return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { data: offer, error: offerError } = await supabaseClient.from('ride_offers').select('*').eq('id', offerId).single();

Â  Â  Â  Â  Â  Â  Â  Â  if(offerError || !offer) { console.error("Offer not found"); return; }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const bookingData = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  offer_id: offerId,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  passenger_id: this.state.currentUser.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'pending',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  booking_segment: bookingDetails ? bookingDetails.segment : 'full',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: bookingDetails ? bookingDetails.price : offer.price,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from_city: bookingDetails ? bookingDetails.from : offer.from,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to_city: bookingDetails ? bookingDetails.to : offer.to,

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const { error: insertError } = await supabaseClient.from('bookings').insert(bookingData);



Â  Â  Â  Â  Â  Â  Â  Â  if (insertError) { console.error('Booking insert error:', insertError); return; }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (offer) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const passengerName = this.state.userProfile.full_name || 'ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ°ÑÑĞ°Ğ¶Ğ¸Ñ€';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const message = `

*ĞĞ¾Ğ²Ğ¾Ğµ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ!* ğŸš—



ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ *${passengerName}* Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ¾ Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ:

*ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚:* ${offer.from} â†’ ${offer.to}

*Ğ”Ğ°Ñ‚Ğ°:* ${this.utils.formatDate(offer.ride_date)}



ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ» "ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸", Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ *Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒ* Ğ¸Ğ»Ğ¸ *Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚ÑŒ* Ğ·Ğ°ÑĞ²ĞºÑƒ.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `.trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.utils.sendTelegramNotification(offer.driver_id, message);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  this.render.success('Ğ—Ğ°ÑĞ²ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ°', 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚ Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ. Ğ’Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ ĞµĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ "ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸".', 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾');

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onDetourBookingClick(offerData) {

Â  Â  Â  Â  Â  Â  Â  Â  const offer = JSON.parse(decodeURIComponent(offerData));

Â  Â  Â  Â  Â  Â  Â  Â  this.render.bookingOptionsModal(offer);

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onConfirmBookingSegment(dataset) {

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onBookingModalCancel();

Â  Â  Â  Â  Â  Â  Â  Â  const bookingDetails = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  segment: dataset.segment,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: parseInt(dataset.price),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: dataset.from,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: dataset.to,

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onRequestBooking(dataset.offerId, bookingDetails);

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onBookingModalCancel() {

Â  Â  Â  Â  Â  Â  Â  Â  const overlay = document.getElementById('booking-modal-overlay');

Â  Â  Â  Â  Â  Â  Â  Â  const modal = document.getElementById('booking-modal');

Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.remove('show');

Â  Â  Â  Â  Â  Â  Â  Â  modal.classList.remove('show');

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  }, 300);

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onUpdateBookingStatus(bookingId, status) {

Â  Â  Â  Â  Â  Â  Â  Â  const { data: booking, error: bookingFetchError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('bookings')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*, ride_offers(*)')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', bookingId)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();



Â  Â  Â  Â  Â  Â  Â  Â  if (bookingFetchError || !booking) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Booking not found for status update:', bookingFetchError);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const offer = booking.ride_offers;

Â  Â  Â  Â  Â  Â  Â  Â  const passengerId = booking.passenger_id;

Â  Â  Â  Â  Â  Â  Â  Â  const isPassengerAction = this.state.currentUser.id === passengerId;

Â  Â  Â  Â  Â  Â  Â  Â  const isLinkedToRequest = offer && offer.linked_request_id;



Â  Â  Â  Â  Â  Â  Â  Â  // SCENARIO 1: Passenger REJECTS an offer made by a driver

Â  Â  Â  Â  Â  Â  Â  Â  if (isPassengerAction && isLinkedToRequest && status === 'rejected') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('ride_requests').update({ status: 'open' }).eq('id', offer.linked_request_id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('bookings').delete().eq('id', bookingId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('ride_offers').delete().eq('id', offer.id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const message = `ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ğ»(Ğ°) Ğ²Ğ°ÑˆĞµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞµ (${offer.from} â†’ ${offer.to}).`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await this.utils.sendTelegramNotification(offer.driver_id, message);

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  // SCENARIO 2: Passenger ACCEPTS an offer made by a driver

Â  Â  Â  Â  Â  Â  Â  Â  else if (isPassengerAction && isLinkedToRequest && status === 'confirmed') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('bookings').update({ status: 'confirmed' }).eq('id', bookingId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('ride_requests').update({ status: 'closed' }).eq('id', offer.linked_request_id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const message = `ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ Ğ¿Ñ€Ğ¸Ğ½ÑĞ»(Ğ°) Ğ²Ğ°ÑˆĞµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞµ (${offer.from} â†’ ${offer.to})! ĞŸĞ¾ĞµĞ·Ğ´ĞºĞ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ°.`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await this.utils.sendTelegramNotification(offer.driver_id, message);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // SCENARIO 3: Default driver action (accepting/rejecting a standard booking)

Â  Â  Â  Â  Â  Â  Â  Â  else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('bookings').update({ status }).eq('id', bookingId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const passengerName = this.state.userProfile.full_name;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let message = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (status === 'confirmed') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message = `*Ğ’Ğ°ÑˆĞµ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾!* âœ…\n\nĞ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ *${offer.driver_name}* Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ» Ğ²Ğ°ÑˆÑƒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ:\n*ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚:* ${offer.from} â†’ ${offer.to}\n*Ğ”Ğ°Ñ‚Ğ°:* ${this.utils.formatDate(offer.ride_date)} Ğ² *${offer.ride_time}*`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (status === 'rejected') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message = `*Ğ’Ğ°ÑˆĞµ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¾* âŒ\n\nĞš ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ, Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ğ» Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ:\n*ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚:* ${offer.from} â†’ ${offer.to}\n*Ğ”Ğ°Ñ‚Ğ°:* ${this.utils.formatDate(offer.ride_date)}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (message) await this.utils.sendTelegramNotification(passengerId, message);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onMyTripsClick();

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onCancelBooking(bookingId) {

Â  Â  Â  Â  Â  Â  Â  Â  const { data: booking, error: bookingError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('bookings')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*, ride_offers(*)')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', bookingId)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();



Â  Â  Â  Â  Â  Â  Â  Â  if (bookingError || !booking) { console.error('Error fetching booking to cancel:', bookingError); return; }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const offer = booking.ride_offers;

Â  Â  Â  Â  Â  Â  Â  Â  const passengerName = this.state.userProfile.full_name || 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€';

Â  Â  Â  Â  Â  Â  Â  Â  const message = `*ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ±Ñ€Ğ¾Ğ½ÑŒ* ğŸ§â€â™‚ï¸\n\nĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€ *${passengerName}* Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ:\n*ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚:* ${offer.from} â†’ ${offer.to}\n*Ğ”Ğ°Ñ‚Ğ°:* ${this.utils.formatDate(offer.ride_date)}`;

Â  Â  Â  Â  Â  Â  Â  Â  await this.utils.sendTelegramNotification(offer.driver_id, message);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('bookings').delete().eq('id', bookingId);

Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error('Failed to cancel booking'); return; }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const currentScreen = this.state.navigationHistory[this.state.navigationHistory.length - 1];

Â  Â  Â  Â  Â  Â  Â  Â  if (currentScreen === 'list-screen') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onViewDriverOffers();

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onMyTripsClick();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onDeleteOffer(offerId) {

Â  Â  Â  Â  Â  Â  Â  Â  const { data: bookings, error: bookingsError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('bookings')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('passenger_id, ride_offers(from, to, ride_date)')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('offer_id', offerId);



Â  Â  Â  Â  Â  Â  Â  Â  if (bookingsError) { console.error('Failed to fetch bookings for notification:', bookingsError); }



Â  Â  Â  Â  Â  Â  Â  Â  if (bookings && bookings.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const offerDetails = bookings[0].ride_offers;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const message = `*ĞŸĞ¾ĞµĞ·Ğ´ĞºĞ° Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼* âŒ\n\nĞš ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ, Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ğ» Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ:\n*ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚:* ${offerDetails.from} â†’ ${offerDetails.to}\n*Ğ”Ğ°Ñ‚Ğ°:* ${this.utils.formatDate(offerDetails.ride_date)}\n\nĞ’Ğ°ÑˆĞµ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const notificationPromises = bookings.map(b => this.utils.sendTelegramNotification(b.passenger_id, message));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all(notificationPromises);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('ride_offers').delete().eq('id', offerId);

Â  Â  Â  Â  Â  Â  Â  Â  if (error) { console.error('Failed to delete offer'); return; }

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onMyTripsClick();

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async onCancelRequest(requestId) {

Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('ride_requests').delete().eq('id', requestId);

Â  Â  Â  Â  Â  Â  Â  Â  Â if (error) { console.error('Failed to cancel request'); return; }

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onMyTripsClick();

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  async onCancelParcelRequest(requestId) {

Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await supabaseClient.from('parcel_requests').delete().eq('id', requestId);

Â  Â  Â  Â  Â  Â  Â  Â  Â if (error) { console.error('Failed to cancel parcel request'); return; }

Â  Â  Â  Â  Â  Â  Â  Â  this.handlers.onMyTripsClick();

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  onBackToHub() {

Â  Â  Â  Â  Â  Â  Â  Â  const screen = this.state.userRole === 'driver' ? 'driver-dashboard-screen' : 'passenger-home-screen';

Â  Â  Â  Â  Â  Â  Â  Â  const title = this.state.userRole === 'driver' ? 'ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ' : 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€';

Â  Â  Â  Â  Â  Â  Â  Â  this.state.navigationHistory = [screen];

Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to(screen, title);

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  async onOfferRideToRequest(requestId) {

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.state.userProfile?.driver_car || !this.state.userProfile.driver_car.trim()) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.navigation.to('profile-screen', 'ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const { data: request, error: requestError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('ride_requests')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('id', requestId)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();



Â  Â  Â  Â  Â  Â  Â  Â  if (requestError || !request) { console.error("Request not found:", requestError); return; }



Â  Â  Â  Â  Â  Â  Â  Â  // --- Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬ ---

Â  Â  Â  Â  Â  Â  Â  Â  // ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» "08-10" Ğ² ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ "08:00"

Â  Â  Â  Â  Â  Â  Â  Â  const timeForOffer = request.time_interval.split('-')[0] + ':00';



Â  Â  Â  Â  Â  Â  Â  Â  const { data: newOffer, error: offerError } = await supabaseClient

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('ride_offers')

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .insert({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_id: this.state.currentUser.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_username: this.state.currentUser.username,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_name: this.state.userProfile.full_name,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  driver_car: this.state.userProfile.driver_car,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from: request.from,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to: request.to,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_date: request.ride_date,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ride_time: timeForOffer, // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  seats: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: request.price,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linked_request_id: requestId

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select()

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (offerError) { console.error("Failed to create offer:", offerError); return; }



Â  Â  Â  Â  Â  Â  Â  Â  const { error: bookingError } = await supabaseClient.from('bookings').insert({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  offer_id: newOffer.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  passenger_id: request.passenger_id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'pending',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price: newOffer.price,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  from_city: newOffer.from,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  to_city: newOffer.to

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  if (bookingError) { console.error("Failed to create booking:", bookingError); return; }



Â  Â  Â  Â  Â  Â  Â  Â  await supabaseClient.from('ride_requests').update({ status: 'pending_confirmation' }).eq('id', requestId);



Â  Â  Â  Â  Â  Â  Â  Â  const message = `*Ğ’Ğ°Ğ¼ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ!* ğŸš—\n\nĞ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ *${newOffer.driver_name}* Ğ½Ğ° *${newOffer.driver_car}* Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ½ÑƒĞ»ÑÑ Ğ½Ğ° Ğ²Ğ°ÑˆÑƒ Ğ·Ğ°ÑĞ²ĞºÑƒ:\n*ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚:* ${newOffer.from} â†’ ${newOffer.to}\n*Ğ”Ğ°Ñ‚Ğ°:* ${this.utils.formatDate(newOffer.ride_date)}\n\nĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ "ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸".`;

Â  Â  Â  Â  Â  Â  Â  Â  await this.utils.sendTelegramNotification(request.passenger_id, message);



Â  Â  Â  Â  Â  Â  Â  Â  const button = document.querySelector(`.offer-ride-btn[data-request-id="${requestId}"]`);

Â  Â  Â  Â  Â  Â  Â  Â  if (button) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.textContent = 'ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.remove('bg-green-500', 'hover:bg-green-600');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('bg-slate-400', 'cursor-not-allowed');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  },

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- NAVIGATION ---

Â  Â  Â  Â  navigation: {

Â  Â  Â  Â  Â  Â  to(screenId, title) {

Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.currentConversation.subscription) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  supabaseClient.removeChannel(App.state.currentConversation.subscription);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.currentConversation.subscription = null;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(screenId).classList.add('active');

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('headerTitle').textContent = title;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.navigationHistory[App.state.navigationHistory.length - 1] !== screenId) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  App.state.navigationHistory.push(screenId);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('backButton').classList.toggle('invisible', App.state.navigationHistory.length <= 1);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (screenId === 'offer-screen') App.render.populateOfferForm();

Â  Â  Â  Â  Â  Â  Â  Â  if (screenId === 'profile-screen') App.render.populateProfileForm();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('main-content').scrollTop = 0;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  back() {

Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.navigationHistory.length <= 1) return;

Â  Â  Â  Â  Â  Â  Â  Â  App.state.navigationHistory.pop();

Â  Â  Â  Â  Â  Â  Â  Â  const lastScreen = App.state.navigationHistory[App.state.navigationHistory.length - 1];

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const titles = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'passenger-home-screen': 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'driver-dashboard-screen': 'ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'list-screen': document.getElementById('headerTitle').textContent,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'my-trips-screen': 'ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'profile-screen': 'ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  const title = titles[lastScreen] || 'ĞŸĞ¾Ğ¿ÑƒÑ‚ĞºĞ° 12';

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(lastScreen).classList.add('active');

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('headerTitle').textContent = title;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('backButton').classList.toggle('invisible', App.state.navigationHistory.length <= 1);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  },



Â  Â  Â  Â  // --- UI RENDERING & TEMPLATES ---

Â  Â  Â  Â  render: {

Â  Â  Â  Â  Â  Â  allScreens() {

Â  Â  Â  Â  Â  Â  Â  Â  const screenTemplates = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'passenger-home-screen': `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-5">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mb-1">Ğ§Ñ‚Ğ¾ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ?</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="view-driver-offers-btn" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">Ğ¡Ğ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="create-passenger-request-btn" class="text-sm btn w-full bg-slate-100 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-200">ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="send-parcel-btn" class="text-sm btn w-full bg-purple-100 text-purple-800 font-bold py-3 px-4 rounded-xl hover:bg-purple-200">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="my-trips-btn" class="text-sm mt-4 btn w-full border border-slate-300 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-100">ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ Ğ¸ Ğ·Ğ°ÑĞ²ĞºĞ¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'driver-dashboard-screen': `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-5">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mb-1">ĞšĞ°Ğ±Ğ¸Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="view-passenger-requests-btn" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">Ğ¡Ğ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºĞ¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="publish-ride-btn" class="text-sm btn w-full bg-slate-100 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-200">ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ñ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="my-trips-btn" class="text-sm mt-4 btn w-full border border-slate-300 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-100">ĞœĞ¾Ğ¸ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'offer-screen': this.getOfferFormTemplate(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'passenger-request-screen': this.getPassengerRequestFormTemplate(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'parcel-request-screen': this.getParcelRequestFormTemplate(),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'list-screen': `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-section-container" class="hidden">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="filter-toggle-btn" class="flex justify-between items-center w-full mb-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-base font-semibold text-slate-800">Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg id="filter-toggle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500"><path d="m18 15-6-6-6 6"/></svg>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-content" class="space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-from" class="block text-xs font-medium text-slate-600 mb-1">ĞÑ‚ĞºÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-from" name="from" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Ğ›ÑĞ±Ğ¾Ğ¹</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${App.config.cities.map(c => `<option value="${c}">${c}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-to" class="block text-xs font-medium text-slate-600 mb-1">ĞšÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-to" name="to" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Ğ›ÑĞ±Ğ¾Ğ¹</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${App.config.cities.map(c => `<option value="${c}">${c}</option>`).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-date" class="block text-xs font-medium text-slate-600 mb-1">Ğ”Ğ°Ñ‚Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="filter-date" name="date" class="w-full p-2 border border-slate-200 rounded-lg text-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-type-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-1">Ğ¢Ğ¸Ğ¿ Ğ·Ğ°ÑĞ²ĞºĞ¸</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="filter-type-buttons" class="flex p-1 bg-slate-200 rounded-lg">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-type="all" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600 active">Ğ’ÑĞµ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-type="ride" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600">ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ñ‹</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-type="parcel" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600">ĞŸĞ¾ÑÑ‹Ğ»ĞºĞ¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-3 pt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="reset-filters-btn" class="flex-1 text-sm btn border border-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-100">Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="apply-filters-btn" class="flex-1 text-sm btn bg-slate-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700">ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="list-container" class="space-y-3"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="no-results" class="text-center text-slate-500 py-10 hidden"><h3 id="no-results-title" class="text-base font-semibold"></h3><p id="no-results-text" class="text-xs"></p></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'success-screen': `<div class="p-5 flex flex-col items-center justify-center h-full text-center"><div class="mb-4"><svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><h2 id="success-title" class="text-xl font-bold mt-4 mb-1"></h2><p id="success-text" class="text-slate-600 mb-8 text-sm"></p><button id="back-to-hub-btn" class="text-sm btn w-full max-w-xs bg-slate-800 text-white font-bold py-3 px-4 rounded-lg"></button></div>`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'chat-screen': `<div class="flex-1 flex flex-col h-full"><div id="chat-messages" class="flex-1 p-4 space-y-4 overflow-y-auto flex flex-col"></div><div id="chat-footer" class="p-3 border-t border-slate-200 flex-shrink-0"><form id="chat-form" class="flex items-center space-x-2"><input id="chat-message-input" type="text" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ..." required><button type="submit" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button></form></div></div>`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'my-trips-screen': `<div class="flex-1 flex flex-col"><div id="my-trips-container" class="p-5 space-y-4 flex-1"></div></div>`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'profile-screen': this.getProfileFormTemplate(),

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  for (const [id, html] of Object.entries(screenTemplates)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(id).innerHTML = html;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  updateRoleSwitcherUI() {

Â  Â  Â  Â  Â  Â  Â  Â  const switcher = document.getElementById('role-switcher');

Â  Â  Â  Â  Â  Â  Â  Â  if (App.state.userRole === 'driver') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.classList.add('driver');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.classList.remove('passenger');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.classList.add('passenger');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switcher.classList.remove('driver');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  updateAvatar() {

Â  Â  Â  Â  Â  Â  Â  Â  const avatarBtn = document.getElementById('profile-avatar-btn');

Â  Â  Â  Â  Â  Â  Â  Â  if (!avatarBtn) return;



Â  Â  Â  Â  Â  Â  Â  Â  const user = App.state.currentUser;

Â  Â  Â  Â  Â  Â  Â  Â  if (user?.photo_url) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarBtn.innerHTML = `<img src="${user.photo_url}" alt="Avatar">`;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const initial = user?.first_name ? user.first_name.charAt(0).toUpperCase() : '?';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  avatarBtn.innerHTML = `<span>${initial}</span>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  list(items, type) {

Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('list-container');

Â  Â  Â  Â  Â  Â  Â  Â  const noResults = document.getElementById('no-results');

Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (!items || items.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noResults.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('no-results-title').textContent = type === 'driverOffer' ? 'ĞŸĞ¾ĞµĞ·Ğ´Ğ¾Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾' : 'Ğ—Ğ°ÑĞ²Ğ¾Ğº Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('no-results-text').textContent = type === 'driverOffer' ? 'ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ·Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ÑĞ²Ğ¾Ñ Ğ·Ğ°ÑĞ²ĞºÑƒ.' : 'ĞŸĞ¾ Ğ²Ğ°ÑˆĞ¸Ğ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾.';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  noResults.classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  items.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'bg-white border border-slate-200 rounded-xl p-4 space-y-3';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = type === 'driverOffer' ? this.getDriverOfferCard(item) : this.getPassengerRequestCard(item);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(card);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  myTrips(data, role) {

Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('my-trips-container');

Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (role === 'driver') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!data || data.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<div class="text-center text-slate-500 py-10"><h3 class="text-base font-semibold">Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾ĞµĞ·Ğ´Ğ¾Ğº</h3><p class="text-xs">ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ½Ğ° Ğ·Ğ´ĞµÑÑŒ Ğ¿Ğ¾ÑĞ²Ğ¸Ğ»Ğ°ÑÑŒ.</p></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let content = data.map(offer =>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyDriverOfferCard(offer)}</div>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = content;



Â  Â  Â  Â  Â  Â  Â  Â  } else { // Passenger

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { bookings, requests, parcels } = data;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if ((!bookings || bookings.length === 0) &&Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (!requests || requests.length === 0) &&Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (!parcels || parcels.length === 0)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<div class="text-center text-slate-500 py-10"><h3 class="text-base font-semibold">Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ĞµĞ¹</h3><p class="text-xs">Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ Ğ¸Ğ»Ğ¸ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ·Ğ°ÑĞ²ĞºÑƒ.</p></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let content = '';



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (bookings && bookings.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += `<h3 class="text-base font-bold text-slate-800 px-1 pt-2">ĞœĞ¾Ğ¸ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</h3>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += bookings.map(booking =>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyBookingCard(booking)}</div>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (requests && requests.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += `<h3 class="text-base font-bold text-slate-800 px-1 pt-4">ĞœĞ¾Ğ¸ Ğ·Ğ°ÑĞ²ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸</h3>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += requests.map(request =>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyRequestCard(request)}</div>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (parcels && parcels.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += `<h3 class="text-base font-bold text-slate-800 px-1 pt-4">ĞœĞ¾Ğ¸ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºĞ¸</h3>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += parcels.map(parcel =>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">${this.getMyParcelRequestCard(parcel)}</div>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = content;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  success(title, text, buttonText) {

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('success-title').textContent = title;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('success-text').textContent = text;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('back-to-hub-btn').textContent = buttonText;

Â  Â  Â  Â  Â  Â  Â  Â  App.navigation.to('success-screen', 'Ğ£ÑĞ¿ĞµÑ…');

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  populateOfferForm() {

Â  Â  Â  Â  Â  Â  Â  Â  const profile = App.state.userProfile;

Â  Â  Â  Â  Â  Â  Â  Â  if (!profile) return;

Â  Â  Â  Â  Â  Â  Â  Â  const form = document.getElementById('offer-form');

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#driver-name').value = profile.full_name || '';

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#driver-car').value = profile.driver_car || '';

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  populateProfileForm() {

Â  Â  Â  Â  Â  Â  Â  Â  const profile = App.state.userProfile;

Â  Â  Â  Â  Â  Â  Â  Â  const form = document.getElementById('profile-form');

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#profile-name').value = profile?.full_name || App.state.currentUser.first_name || '';

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#profile-car').value = profile?.driver_car || '';

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  updateOfferOptionsUI(form) {

Â  Â  Â  Â  Â  Â  Â  Â  const from = form.querySelector('input[name="from"]').value;

Â  Â  Â  Â  Â  Â  Â  Â  const to = form.querySelector('input[name="to"]').value;

Â  Â  Â  Â  Â  Â  Â  Â  const ferryToggle = form.querySelector('#via-ferry-toggle');

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let price = App.config.prices.base;

Â  Â  Â  Â  Â  Â  Â  Â  const isCheboksaryRoute = from === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹' || to === 'Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹';



Â  Â  Â  Â  Â  Â  Â  Â  if (isCheboksaryRoute) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price = App.config.prices.cheboksary;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#ferry-price-increase').classList.add('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isFerryChecked = ferryToggle && ferryToggle.checked;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#ferry-price-increase').classList.toggle('hidden', !isFerryChecked);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isFerryChecked) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  price += App.config.prices.ferrySurcharge;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  form.querySelector('#publish-price').textContent = price;

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  bookingOptionsModal(offer) {

Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('booking-options-container');

Â  Â  Â  Â  Â  Â  Â  Â  const priceFull = App.config.prices.base;

Â  Â  Â  Â  Â  Â  Â  Â  const pricePart = App.config.prices.cheboksary;



Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="confirm-booking-segment-btn w-full flex justify-between items-center text-left p-3 text-blue-500 text-base"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-offer-id="${offer.id}" data-segment="full" data-price="${priceFull}" data-from="${offer.from}" data-to="${offer.to}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${offer.from} â†’ ${offer.to}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">${priceFull} â‚½</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-px bg-slate-200"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="confirm-booking-segment-btn w-full flex justify-between items-center text-left p-3 text-blue-500 text-base"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-offer-id="${offer.id}" data-segment="start_to_cheb" data-price="${pricePart}" data-from="${offer.from}" data-to="Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${offer.from} â†’ Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">${pricePart} â‚½</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-px bg-slate-200"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="confirm-booking-segment-btn w-full flex justify-between items-center text-left p-3 text-blue-500 text-base"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-offer-id="${offer.id}" data-segment="cheb_to_end" data-price="${pricePart}" data-from="Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹" data-to="${offer.to}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹ â†’ ${offer.to}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-semibold">${pricePart} â‚½</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  `;



Â  Â  Â  Â  Â  Â  Â  Â  const overlay = document.getElementById('booking-modal-overlay');

Â  Â  Â  Â  Â  Â  Â  Â  const modal = document.getElementById('booking-modal');

Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  requestAnimationFrame(() => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlay.classList.add('show');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modal.classList.add('show');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getDriverOfferCard(item) {

Â  Â  Â  Â  Â  Â  Â  Â  const seatsLeft = item.seats_left;

Â  Â  Â  Â  Â  Â  Â  Â  const seatsText = seatsLeft === 1 ? '1 Ğ¼ĞµÑÑ‚Ğ¾' : (seatsLeft > 1 && seatsLeft < 5 ? `${seatsLeft} Ğ¼ĞµÑÑ‚Ğ°` : `${seatsLeft} Ğ¼ĞµÑÑ‚`);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let buttonHtml = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (item.currentUserBookingId) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttonHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cancel-booking-btn btn w-full bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors text-sm"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-booking-id="${item.currentUserBookingId}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ±Ñ€Ğ¾Ğ½ÑŒ

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonDisabled = seatsLeft <= 0 ? 'disabled' : '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonClass = seatsLeft <= 0 ? 'bg-slate-300' : 'bg-blue-500 hover:bg-blue-600';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonText = seatsLeft <= 0 ? 'ĞœĞµÑÑ‚ Ğ½ĞµÑ‚' : 'Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ';



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (item.via_cheboksary_detour) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const offerData = encodeURIComponent(JSON.stringify(item));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  buttonHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="detour-booking-btn btn w-full text-white font-bold py-2 px-4 rounded-lg transition-colors text-sm ${buttonClass}"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-offer='${offerData}' ${buttonDisabled}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â buttonHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="request-booking-btn btn w-full text-white font-bold py-2 px-4 rounded-lg transition-colors text-sm ${buttonClass}"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data-offer-id="${item.id}" ${buttonDisabled}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${item.from} â†’ ${item.to}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${item.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-600 text-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ”Ğ°Ñ‚Ğ°:</strong> ${App.utils.formatDate(item.ride_date)} Ğ² <strong>${item.ride_time}</strong></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ:</strong> ${item.driver_name} Ğ½Ğ° ${item.driver_car}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾:</strong> <span class="font-bold ${seatsLeft <= 1 ? 'text-red-500' : 'text-green-600'}">${seatsText}</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.via_ferry ? `<div class="text-xs font-semibold text-blue-800 bg-blue-100 rounded-full px-3 py-1 text-center">â›´ï¸ Ğ§ĞµÑ€ĞµĞ· Ğ¿Ğ°Ñ€Ğ¾Ğ¼</div>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.via_cheboksary_detour ? `<div class="text-xs font-semibold text-orange-800 bg-orange-100 rounded-full px-3 py-1 text-center"> detour via Cheboksary</div>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item.via_cheboksary ? `<div class="text-xs font-semibold text-green-800 bg-green-100 rounded-full px-3 py-1 text-center">Ğ”Ğ¾/Ğ˜Ğ· Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€</div>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonHtml}

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  getPassengerRequestCard(item) {

Â  Â  Â  Â  Â  Â  Â  Â  const isParcel = item.type === 'parcel';

Â  Â  Â  Â  Â  Â  Â  Â  const buttonHtml = isParcelÂ 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<a href="https://t.me/${item.sender_username}" target="_blank" class="block w-full text-center bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors text-sm">Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ</a>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `<button class="offer-ride-btn btn w-full bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors text-sm" data-request-id="${item.id}">ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ</button>`;



Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${item.from} â†’ ${item.to}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${item.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-600 text-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ”Ğ°Ñ‚Ğ°:</strong> ${App.utils.formatDate(item.ride_date)}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>${isParcel ? 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒ' : 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€'}:</strong> ${isParcel ? item.sender_name : item.passenger_name}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${!isParcel ? `<p><strong>Ğ’Ñ€ĞµĞ¼Ñ:</strong> ${item.time_interval}</p>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isParcel ? `<div class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">ĞŸĞ¾ÑÑ‹Ğ»ĞºĞ°</div>` : `<div class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€</div>`}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${App.state.userRole === 'driver' ? buttonHtml : ''}

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getMyDriverOfferCard(offer) {

Â  Â  Â  Â  Â  Â  Â  Â  const confirmedBookings = offer.bookings.filter(b => b.status === 'confirmed');

Â  Â  Â  Â  Â  Â  Â  Â  const pendingBookings = offer.bookings.filter(b => b.status === 'pending');

Â  Â  Â  Â  Â  Â  Â  Â  const seatsLeft = offer.seats - confirmedBookings.length;



Â  Â  Â  Â  Â  Â  Â  Â  let bookingsHtml = '<div class="text-xs text-slate-500">ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ¿Ğ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ğ¾Ğ².</div>';

Â  Â  Â  Â  Â  Â  Â  Â  if (offer.bookings.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bookingsHtml = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${pendingBookings.length > 0 ? `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold mt-2 text-sm">Ğ—Ğ°ÑĞ²ĞºĞ¸ Ğ½Ğ° Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${pendingBookings.map(b => `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center bg-amber-50 p-2 rounded-lg">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">${b.profiles?.full_name || 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€'}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="accept-booking-btn bg-green-500 text-white text-xs font-bold py-1 px-2 rounded" data-booking-id="${b.id}">ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="reject-booking-btn bg-red-500 text-white text-xs font-bold py-1 px-2 rounded" data-booking-id="${b.id}">ĞÑ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚ÑŒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${confirmedBookings.length > 0 ? `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold mt-2 text-sm">ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°ÑÑĞ°Ğ¶Ğ¸Ñ€Ñ‹:</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${confirmedBookings.map(b => `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center bg-slate-50 p-2 rounded-lg">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm">${b.profiles?.full_name || 'ĞŸĞ°ÑÑĞ°Ğ¶Ğ¸Ñ€'}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${b.profiles?.username ? `<a href="https://t.me/${b.profiles.username}" target="_blank" class="text-xs bg-blue-500 text-white font-semibold py-1 px-2 rounded-md hover:bg-blue-600">ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ</a>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${offer.from} â†’ ${offer.to}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">${App.utils.formatDate(offer.ride_date)} Ğ² ${offer.ride_time}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${offer.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-600 text-sm">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p><strong>Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾ Ğ¼ĞµÑÑ‚:</strong> <span class="font-bold ${seatsLeft <= 1 ? 'text-red-500' : 'text-green-600'}">${seatsLeft} Ğ¸Ğ· ${offer.seats}</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t border-slate-100 pt-2 mt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${bookingsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-offer-btn btn w-full bg-red-50 text-red-700 font-bold py-2 px-4 rounded-lg hover:bg-red-100 transition-colors mt-2 text-sm" data-offer-id="${offer.id}">Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºÑƒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getMyBookingCard(booking) {

Â  Â  Â  Â  Â  Â  Â  Â  const offer = booking.ride_offers;

Â  Â  Â  Â  Â  Â  Â  Â  if (!offer) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="text-red-500 text-sm">ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹. Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¾Ğ½Ğ° Ğ±Ñ‹Ğ»Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ° Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼.</div>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const statusClasses = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pending: 'bg-amber-100 text-amber-800',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmed: 'bg-green-100 text-green-800',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rejected: 'bg-red-100 text-red-800'

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  const statusText = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pending: 'ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmed: 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ğ»',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rejected: 'Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ğ»'

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  let actionButtons = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (booking.status === 'pending' && offer.linked_request_id) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusText[booking.status] = 'ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionButtons = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="reject-booking-btn text-xs bg-red-100 text-red-700 font-semibold py-1 px-3 rounded-lg" data-booking-id="${booking.id}">ĞÑ‚ĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚ÑŒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="accept-booking-btn text-xs bg-green-100 text-green-700 font-semibold py-1 px-3 rounded-lg" data-booking-id="${booking.id}">ĞŸÑ€Ğ¸Ğ½ÑÑ‚ÑŒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionButtons = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${booking.status === 'confirmed' && offer.driver_username ? `<a href="https://t.me/${offer.driver_username}" target="_blank" class="text-xs text-blue-600 hover:underline font-semibold">ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ</a>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${booking.status !== 'rejected' ? `<button class="cancel-booking-btn text-xs text-red-600 hover:underline" data-booking-id="${booking.id}">ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</button>` : ''}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  }





Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${booking.from_city} â†’ ${booking.to_city}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">${App.utils.formatDate(offer.ride_date)} Ğ² ${offer.ride_time}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">Ğ’Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ: ${offer.driver_name} (${offer.driver_car})</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${booking.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-between items-center mt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-semibold px-2.5 py-0.5 rounded-full ${statusClasses[booking.status]}">${statusText[booking.status]}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${actionButtons}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getMyRequestCard(request) {

Â  Â  Â  Â  Â  Â  Â  Â  if (request.status === 'pending_confirmation') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start opacity-60">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${request.from} â†’ ${request.to}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">${App.utils.formatDate(request.ride_date)} (Ğ²Ñ€ĞµĞ¼Ñ: ${request.time_interval})</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${request.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center text-sm text-amber-700 font-semibold bg-amber-50 p-2 rounded-lg mt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ² "ĞœĞ¾Ğ¸Ñ… Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑÑ…"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-between items-start">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${request.from} â†’ ${request.to}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">${App.utils.formatDate(request.ride_date)} (Ğ²Ñ€ĞµĞ¼Ñ: ${request.time_interval})</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${request.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end items-center mt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="cancel-request-btn text-xs text-red-600 hover:underline" data-request-id="${request.id}">ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  getMyParcelRequestCard(parcel) {

Â  Â  Â  Â  Â  Â  Â  Â  return `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="flex justify-between items-start">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-bold text-base">${parcel.from} â†’ ${parcel.to}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">${App.utils.formatDate(parcel.ride_date)}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold">${parcel.price} â‚½</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mt-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">ĞŸĞ¾ÑÑ‹Ğ»ĞºĞ°</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="cancel-parcel-request-btn text-xs text-red-600 hover:underline" data-request-id="${parcel.id}">ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getOfferFormTemplate() {

Â  Â  Â  Â  Â  Â  Â  Â  const optionsHtml = App.config.cities.map(city => `<option value="${city}">${city}</option>`).join('');

Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="p-5"><h2 class="text-lg font-bold mb-4">Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞµ</h2><form id="offer-form" class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞÑ‚ĞºÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="from" required><input type="hidden" name="to" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="ferry-toggle-container" class="hidden p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="via-ferry-toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">Ğ§ĞµÑ€ĞµĞ· Ğ¿Ğ°Ñ€Ğ¾Ğ¼</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="ferry-price-increase" class="text-sm text-slate-800 font-semibold hidden">(+${App.config.prices.ferrySurcharge} â‚½)</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="via-ferry-toggle" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="cheboksary-detour-container" class="hidden p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="via-cheboksary-detour-toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">Ğ—Ğ°ĞµĞ·Ğ¶Ğ°Ñ Ğ² Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="via-cheboksary-detour-toggle" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div></label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4"><div><label class="block text-xs font-medium text-slate-600 mb-2">Ğ”Ğ°Ñ‚Ğ°</label><input type="date" name="date" id="date-offer" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required></div><div><label class="block text-xs font-medium text-slate-600 mb-2">Ğ’Ñ€ĞµĞ¼Ñ</label><input type="time" name="time" id="time-offer" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required></div></div><input type="hidden" name="driverName" id="driver-name"><input type="hidden" name="driverCar" id="driver-car"><div><label class="block text-xs font-medium text-slate-600 mb-2">ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¼ĞµÑÑ‚</label><input type="number" name="seats" min="1" max="8" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 3" required></div><button type="submit" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">ĞĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒ (<span id="publish-price">${App.config.prices.base}</span> â‚½)</button></form></div>`;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getPassengerRequestFormTemplate() {

Â  Â  Â  Â  Â  Â  Â  Â  Â const optionsHtml = App.config.cities.map(city => `<option value="${city}">${city}</option>`).join('');

Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="p-5"><h2 class="text-lg font-bold mb-4">Ğ’Ğ°ÑˆĞ° Ğ·Ğ°ÑĞ²ĞºĞ°</h2><form id="passenger-request-form" class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞÑ‚ĞºÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="from" required><input type="hidden" name="to" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" name="date" id="date-request" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required><div><label class="block text-xs font-medium text-slate-600 mb-2">Ğ–ĞµĞ»Ğ°ĞµĞ¼Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹ĞµĞ·Ğ´Ğ°</label><div id="time-interval-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-2"><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">04-06</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">06-08</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">08-10</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">10-12</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">12-14</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">14-16</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">16-18</button><button type="button" class="btn p-2 border border-slate-200 rounded-lg text-xs">18-20</button></div><input type="hidden" name="timeInterval" id="timeIntervalInput" required><div class="form-error-time text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ</div></div><button type="submit" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">ĞÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ</button></form></div>`;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getParcelRequestFormTemplate() {

Â  Â  Â  Â  Â  Â  Â  Â  const optionsHtml = App.config.cities.map(city => `<option value="${city}">${city}</option>`).join('');

Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="p-5"><h2 class="text-lg font-bold mb-4">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ</h2><form id="parcel-request-form" class="space-y-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞÑ‚ĞºÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-xs font-medium text-slate-600 mb-2">ĞšÑƒĞ´Ğ°</label>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ³Ğ¾Ñ€Ğ¾Ğ´</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${optionsHtml}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="from" required><input type="hidden" name="to" required>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label for="date-parcel" class="block text-xs font-medium text-slate-600 mb-2">Ğ”Ğ°Ñ‚Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸</label><input type="date" name="date" id="date-parcel" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required></div><div class="bg-slate-100 p-3 rounded-lg text-center text-slate-600 text-sm">Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸: <span class="font-bold">${App.config.prices.parcel} â‚½</span></div><button type="submit" class="text-sm btn w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ Ğ½Ğ° Ğ¿Ğ¾ÑÑ‹Ğ»ĞºÑƒ</button></form></div>`;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  getProfileFormTemplate() {

Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="p-5"><h2 class="text-lg font-bold mb-4">ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</h2><p class="text-xs text-slate-600 mb-4">Ğ—Ğ´ĞµÑÑŒ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ²Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ. Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚Ğµ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¼, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑƒĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ñ.</p><form id="profile-form" class="space-y-4"><div><label for="profile-name" class="block text-xs font-medium text-slate-600 mb-2">Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ</label><input type="text" name="fullName" id="profile-name" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="ĞĞ»ĞµĞºÑĞµĞ¹" required></div><div><label for="profile-car" class="block text-xs font-medium text-slate-600 mb-2">ĞœĞ°Ñ€ĞºĞ° Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¼Ğ°ÑˆĞ¸Ğ½Ñ‹ (Ğ´Ğ»Ñ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ĞµĞ¹)</label><input type="text" name="driverCar" id="profile-car" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="Kia Rio"></div><button type="submit" class="text-sm btn w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button></form></div>`;

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  },

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- UTILITY FUNCTIONS ---

Â  Â  Â  Â  utils: {

Â  Â  Â  Â  Â  Â  formatDate(dateString) {

Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date(dateString + 'T00:00:00'); // Ensure date is parsed as local

Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date();

Â  Â  Â  Â  Â  Â  Â  Â  const tomorrow = new Date();

Â  Â  Â  Â  Â  Â  Â  Â  tomorrow.setDate(tomorrow.getDate() + 1);

Â  Â  Â  Â  Â  Â  Â  Â  today.setHours(0,0,0,0);

Â  Â  Â  Â  Â  Â  Â  Â  tomorrow.setHours(0,0,0,0);



Â  Â  Â  Â  Â  Â  Â  Â  if (date.getTime() === today.getTime()) return 'Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ';

Â  Â  Â  Â  Â  Â  Â  Â  if (date.getTime() === tomorrow.getTime()) return 'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°';

Â  Â  Â  Â  Â  Â  Â  Â  return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });

Â  Â  Â  Â  Â  Â  },



Â  Â  Â  Â  Â  Â  async sendTelegramNotification(chatId, text) {

Â  Â  Â  Â  Â  Â  Â  Â  const botToken = App.config.botToken;

Â  Â  Â  Â  Â  Â  Â  Â  if (!botToken) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn('Telegram Bot Token is not configured. Skipping notification.');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

Â  Â  Â  Â  Â  Â  Â  Â  const payload = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chat_id: chatId,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: text,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parse_mode: 'Markdown',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reply_markup: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inline_keyboard: [

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: 'ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ', // Ğ¢ĞµĞºÑÑ‚ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞµ

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  url: 'https://t.me/poputka12_bot?startapp='Â  Â  // Ğ¡ÑÑ‹Ğ»ĞºĞ°, ĞºĞ¾Ñ‚Ğ¾Ñ€ÑƒÑ Ğ¾Ñ‚ĞºÑ€Ğ¾ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ°

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorBody = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Telegram API error:", errorBody);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to send Telegram message:", error);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  },



Â  Â  Â  Â  setDefaultDates() {

Â  Â  Â  Â  Â  Â  const today = new Date().toISOString().split('T')[0];

Â  Â  Â  Â  Â  Â  ['date-offer', 'date-request', 'date-parcel'].forEach(id => {

Â  Â  Â  Â  Â  Â  Â  Â  const input = document.getElementById(id);

Â  Â  Â  Â  Â  Â  Â  Â  if (input) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.setAttribute('min', today);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.value = today;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  },

Â  Â  Â  Â Â 

Â  Â  Â  Â  resetForm(form) {

Â  Â  Â  Â  Â  Â  form.reset();

Â  Â  Â  Â  Â  Â  this.setDefaultDates();

Â  Â  Â  Â  Â  Â  form.querySelectorAll('.active').forEach(el => el.classList.remove('active'));

Â  Â  Â  Â  Â  Â  const ferryContainer = form.querySelector('#ferry-toggle-container');

Â  Â  Â  Â  Â  Â  if(ferryContainer) {

Â  Â  Â  Â  Â  Â  Â  Â  ferryContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const detourContainer = form.querySelector('#cheboksary-detour-container');

Â  Â  Â  Â  Â  Â  if(detourContainer) {

Â  Â  Â  Â  Â  Â  Â  Â  detourContainer.classList.add('hidden');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  },



Â  Â  Â  Â  renderFilteredList() {

Â  Â  Â  Â  Â  Â  const { from, to, date, type } = this.state.currentFilters;

Â  Â  Â  Â  Â  Â  let filtered = [...this.state.allRequests];



Â  Â  Â  Â  Â  Â  if (from) {

Â  Â  Â  Â  Â  Â  Â  Â  filtered = filtered.filter(item => item.from === from);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (to) {

Â  Â  Â  Â  Â  Â  Â  Â  filtered = filtered.filter(item => item.to === to);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (date) {

Â  Â  Â  Â  Â  Â  Â  Â  filtered = filtered.filter(item => item.ride_date === date);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (type !== 'all' && this.state.userRole === 'driver') {

Â  Â  Â  Â  Â  Â  Â  Â  filtered = filtered.filter(item => item.type === type);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  this.render.list(filtered, 'passengerRequest');

Â  Â  Â  Â  },

Â  Â  };



Â  Â  // --- APP START ---

Â  Â  document.addEventListener('DOMContentLoaded', () => App.init());

Â  Â  </script>

</body>

</html>
