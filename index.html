<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ü–æ–ø—É—Ç–∫–∞ 12</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
        }
        .screen { display: none; animation: fadeIn 0.3s ease-in-out; }
        .screen.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .role-btn.active, .direction-buttons button.active {
            background-color: #1e293b; /* slate-800 */
            color: white;
        }
        #time-interval-buttons button.active {
            background-color: #1e293b; /* slate-800 */
            color: white;
            border-color: #1e293b;
        }
        #time-interval-buttons button.active .text-slate-500 {
            color: #cbd5e1; /* slate-300 */
        }
        #role-switcher { position: relative; }
        #role-bg {
            position: absolute; width: 36px; height: 36px;
            top: 2px; left: 2px; background-color: white;
            border-radius: 9999px;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            transform: translateX(0px);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        #role-switcher.driver #role-bg { transform: translateX(36px); }
        #role-passenger-icon, #role-driver-icon { transition: opacity 0.3s ease-in-out; }
        #role-passenger-icon span, #role-driver-icon span {
            display: inline-block;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #role-switcher.passenger #role-passenger-icon span,
        #role-switcher.driver #role-driver-icon span { transform: scale(1.15) rotate(-8deg); }
        #role-switcher.passenger #role-driver-icon,
        #role-switcher.driver #role-passenger-icon { opacity: 0.5; }
        #profile-avatar-btn img { width: 100%; height: 100%; object-fit: cover; }
        .modal-overlay { opacity: 0; transition: opacity 0.3s ease-in-out; }
        .modal-overlay.show { opacity: 1; }
        .modal.show { transform: translateY(0); }
        .filter-type-btn.active { background-color: white; color: #1e293b; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        #filter-toggle-icon { transition: transform 0.3s ease-in-out; }
        #filter-content {
            max-height: 500px; overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out; opacity: 1;
        }
        #filter-content.collapsed { max-height: 0; opacity: 0; }
        #filter-toggle-btn.collapsed #filter-toggle-icon { transform: rotate(-180deg); }
        #main-content::-webkit-scrollbar { width: 4px; }
        #main-content::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        #main-content::-webkit-scrollbar-track { background: transparent; }
        
        /* Partner Widget Slider Styles */
        .slider-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem; /* rounded-xl */
        }
        .slider-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .slide {
            flex: 0 0 100%;
            width: 100%;
            position: relative;
        }
        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem; /* p-4 */
            background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0));
            color: white;
        }
        .slider-dots {
            position: absolute;
            bottom: 0.5rem; /* bottom-2 */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem; /* gap-2 */
        }
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 9999px;
            background-color: rgba(255, 255, 255, 0.5);
            transition: background-color 0.3s ease;
        }
        .dot.active {
            background-color: white;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 overflow-hidden">

    <div id="app-container" class="h-screen w-screen max-w-md mx-auto bg-white flex flex-col">
        <header id="app-header" class="p-4 flex items-center justify-between bg-white border-b border-slate-200 flex-shrink-0 sticky top-0 z-10">
            <div class="w-10 h-10 flex items-center justify-start">
                <button id="admin-plus-btn" data-action="navigateTo" data-screen="admin-panel-screen" class="text-slate-500 hover:text-slate-800 transition-colors hidden text-2xl font-light">+</button>
                <button id="backButton" data-action="back" class="text-slate-500 hover:text-slate-800 transition-colors invisible">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
            </div>
            <div id="role-switcher" class="flex items-center p-1 bg-slate-100 rounded-full cursor-pointer">
                <div id="role-bg"></div>
                <div id="role-passenger-icon" class="relative z-10 w-9 h-9 flex items-center justify-center text-xl"><span>üßç</span></div>
                <div id="role-driver-icon" class="relative z-10 w-9 h-9 flex items-center justify-center text-xl"><span>üöó</span></div>
            </div>
            <div class="w-10 h-10 flex items-center justify-end">
                <button id="profile-avatar-btn" class="w-10 h-10 rounded-full bg-slate-200 text-slate-600 font-semibold flex items-center justify-center overflow-hidden shrink-0"></button>
            </div>
        </header>

        <main id="main-content" class="flex-grow overflow-y-auto relative">
            <div id="passenger-home-screen" class="screen active"></div>
            <div id="driver-dashboard-screen" class="screen"></div>
            <div id="offer-screen" class="screen"></div>
            <div id="passenger-request-screen" class="screen"></div>
            <div id="parcel-request-screen" class="screen"></div>
            <div id="list-screen" class="screen"></div>
            <div id="success-screen" class="screen"></div>
            <div id="my-trips-screen" class="screen"></div>
            <div id="profile-screen" class="screen"></div>
            <div id="admin-panel-screen" class="screen"></div>
            <div id="admin-edit-partner-screen" class="screen"></div>
        </main>
        
        <footer id="app-footer" class="p-5 border-t border-slate-200 bg-white flex-shrink-0">
            <a href="https://t.me/poputka12rus" target="_blank" class="text-sm btn w-full bg-sky-100 text-sky-800 font-bold py-3 px-4 rounded-xl hover:bg-sky-200 flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                <span>–ù–∞—à–∞ –≥—Ä—É–ø–ø–∞ –≤ Telegram</span>
            </a>
        </footer>
    </div>

    <div id="booking-modal-overlay" class="modal-overlay fixed inset-0 bg-black bg-opacity-40 z-40 hidden"></div>
    <div id="booking-modal" class="modal fixed bottom-0 left-0 right-0 w-full max-w-md mx-auto bg-transparent z-50 transform translate-y-full transition-transform duration-300">
        <div class="p-4">
            <div id="booking-options-container" class="space-y-2 bg-slate-100 rounded-xl"></div>
            <button id="booking-modal-cancel-btn" class="w-full p-3 mt-2 bg-white rounded-xl text-blue-500 text-lg font-semibold">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <template id="passenger-home-screen-template">
        <div class="p-5">
            <div class="text-center mb-6"><h2 class="text-xl font-bold mb-1">–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?</h2></div>
            <div class="space-y-3">
                <button data-action="viewDriverOffers" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–µ–∑–¥–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π</button>
                <button data-action="navigateTo" data-screen="passenger-request-screen" class="text-sm btn w-full bg-slate-100 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-200">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–µ–∑–¥–∫—É</button>
                <button data-action="myTrips" class="text-sm mt-4 btn w-full border border-slate-300 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-100">–ú–æ–∏ –ø–æ–µ–∑–¥–∫–∏ –∏ –∑–∞—è–≤–∫–∏</button>
            </div>
            <div class="mt-8 partner-widget-container">
                <!-- Partner widget will be rendered here by JS -->
            </div>
        </div>
    </template>
    <template id="driver-dashboard-screen-template">
        <div class="p-5">
            <div class="text-center mb-6"><h2 class="text-xl font-bold mb-1">–ö–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è</h2></div>
            <div class="space-y-3">
                <button data-action="viewPassengerRequests" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-slate-800/10 hover:bg-slate-700">–°–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫–∏</button>
                <button data-action="publishRide" class="text-sm btn w-full bg-slate-100 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-200">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–≤–æ—é –ø–æ–µ–∑–¥–∫—É</button>
                <button data-action="myTrips" class="text-sm mt-4 btn w-full border border-slate-300 text-slate-800 font-bold py-3 px-4 rounded-xl hover:bg-slate-100">–ú–æ–∏ –ø–æ–µ–∑–¥–∫–∏</button>
            </div>
            <div class="mt-8 partner-widget-container">
                <!-- Partner widget will be rendered here by JS -->
            </div>
        </div>
    </template>
    <template id="list-screen-template">
         <div class="p-4 space-y-4">
            <div id="filter-section-container" class="hidden">
                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <button data-action="toggleFilter" id="filter-toggle-btn" class="flex justify-between items-center w-full mb-3">
                        <h3 class="text-base font-semibold text-slate-800">–§–∏–ª—å—Ç—Ä—ã</h3>
                        <svg id="filter-toggle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500"><path d="m18 15-6-6-6 6"/></svg>
                    </button>
                    <div id="filter-content" class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label for="filter-from" class="block text-xs font-medium text-slate-600 mb-1">–û—Ç–∫—É–¥–∞</label>
                                <select id="filter-from" name="from" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white"></select>
                            </div>
                            <div>
                                <label for="filter-to" class="block text-xs font-medium text-slate-600 mb-1">–ö—É–¥–∞</label>
                                <select id="filter-to" name="to" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-white"></select>
                            </div>
                        </div>
                        <div>
                            <label for="filter-date" class="block text-xs font-medium text-slate-600 mb-1">–î–∞—Ç–∞</label>
                            <input type="date" id="filter-date" name="date" class="w-full p-2 border border-slate-200 rounded-lg text-sm">
                        </div>
                        <div id="filter-type-container">
                            <label class="block text-xs font-medium text-slate-600 mb-1">–¢–∏–ø –∑–∞—è–≤–∫–∏</label>
                            <div id="filter-type-buttons" class="flex p-1 bg-slate-200 rounded-lg">
                                <button data-type="all" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600 active">–í—Å–µ</button>
                                <button data-type="ride" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600">–ü–∞—Å—Å–∞–∂–∏—Ä—ã</button>
                                <button data-type="parcel" class="filter-type-btn flex-1 py-1 px-2 rounded-md text-xs font-semibold text-slate-600">–ü–æ—Å—ã–ª–∫–∏</button>
                            </div>
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button data-action="resetFilters" class="flex-1 text-sm btn border border-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-100">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            <button data-action="applyFilters" class="flex-1 text-sm btn bg-slate-800 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-700">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="list-container" class="space-y-3"></div>
            <div id="no-results" class="text-center text-slate-500 py-10 hidden"><h3 id="no-results-title" class="text-base font-semibold"></h3><p id="no-results-text" class="text-xs"></p></div>
        </div>
    </template>
    <template id="success-screen-template">
        <div class="p-5 flex flex-col items-center justify-center h-full text-center">
            <div class="mb-4"><svg class="w-16 h-16 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div>
            <h2 id="success-title" class="text-xl font-bold mt-4 mb-1"></h2>
            <p id="success-text" class="text-slate-600 mb-8 text-sm"></p>
            <button data-action="backToHub" id="back-to-hub-btn" class="text-sm btn w-full max-w-xs bg-slate-800 text-white font-bold py-3 px-4 rounded-lg"></button>
        </div>
    </template>
    <template id="my-trips-screen-template">
         <div class="flex-1 flex flex-col p-5 space-y-4">
             <div id="my-trips-container" class="space-y-4 flex-1"></div>
        </div>
    </template>
    <template id="profile-screen-template">
         <div class="p-5">
            <h2 class="text-lg font-bold mb-4">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <p class="text-xs text-slate-600 mb-4">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—à–µ –∏–º—è. –ï—Å–ª–∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –±—ã—Ç—å –≤–æ–¥–∏—Ç–µ–ª–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.</p>
            <form id="profile-form" class="space-y-4">
                <div>
                    <label for="profile-name" class="block text-xs font-medium text-slate-600 mb-2">–í–∞—à–µ –∏–º—è</label>
                    <input type="text" name="full_name" id="profile-name" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="–ê–ª–µ–∫—Å–µ–π" required>
                </div>
                <div>
                    <label for="profile-car" class="block text-xs font-medium text-slate-600 mb-2">–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω—ã (–¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π)</label>
                    <input type="text" name="driver_car" id="profile-car" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="Kia Rio">
                </div>
                <button type="submit" class="text-sm btn w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </template>
    <template id="offer-screen-template">
        <div class="p-5">
            <h2 class="text-lg font-bold mb-4">–î–∞–Ω–Ω—ã–µ –æ –ø–æ–µ–∑–¥–∫–µ</h2>
            <form id="offer-form" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–û—Ç–∫—É–¥–∞</label>
                        <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option></select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–ö—É–¥–∞</label>
                        <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option></select>
                    </div>
                </div>
                <input type="hidden" name="from" required><input type="hidden" name="to" required>
                <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç</div>
                <div id="ferry-toggle-container" class="hidden p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">
                    <label for="via-ferry-toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">–ß–µ—Ä–µ–∑ –ø–∞—Ä–æ–º</label>
                    <div class="flex items-center space-x-3">
                        <span id="ferry-price-increase" class="text-sm text-slate-800 font-semibold hidden"></span>
                        <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="via-ferry-toggle" name="via_ferry" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label>
                    </div>
                </div>
                <div id="cheboksary-detour-container" class="hidden p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">
                    <label for="via-cheboksary-detour-toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">–ó–∞–µ–∑–∂–∞—é –≤ –ß–µ–±–æ–∫—Å–∞—Ä—ã</label>
                    <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="via-cheboksary-detour-toggle" name="via_cheboksary_detour" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div></label>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</label>
                        <input type="date" name="ride_date" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–í—Ä–µ–º—è –≤—ã–µ–∑–¥–∞</label>
                        <input type="time" name="ride_time" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-600 mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç</label>
                    <input type="number" name="seats" min="1" max="8" class="w-full p-3 border border-slate-200 rounded-lg text-sm" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 3" required>
                </div>
                <button type="submit" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å (<span id="publish-price"></span> ‚ÇΩ)</button>
            </form>
        </div>
    </template>
    <template id="passenger-request-screen-template">
        <div class="p-5">
            <h2 class="text-lg font-bold mb-4">–í–∞—à–∞ –∑–∞—è–≤–∫–∞</h2>
            <form id="passenger-request-form" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–û—Ç–∫—É–¥–∞</label>
                        <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option></select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–ö—É–¥–∞</label>
                        <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option></select>
                    </div>
                </div>
                <input type="hidden" name="from" required><input type="hidden" name="to" required>
                <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç</div>
                <input type="date" name="ride_date" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
                <div>
                    <label class="block text-xs font-medium text-slate-600 mb-2">–ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–µ–∑–¥–∞</label>
                    <div id="time-interval-buttons" class="grid grid-cols-2 gap-3">
                        <button type="button" data-interval="–£—Ç—Ä–æ (6-11)" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
                            <span class="text-2xl mb-1">‚òÄÔ∏è</span>
                            <span class="font-semibold text-sm">–£—Ç—Ä–æ</span>
                            <span class="text-xs text-slate-500">6:00 - 11:00</span>
                        </button>
                        <button type="button" data-interval="–î–µ–Ω—å (12-17)" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
                            <span class="text-2xl mb-1">üòé</span>
                            <span class="font-semibold text-sm">–î–µ–Ω—å</span>
                            <span class="text-xs text-slate-500">12:00 - 17:00</span>
                        </button>
                        <button type="button" data-interval="–í–µ—á–µ—Ä (18-22)" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
                            <span class="text-2xl mb-1">üåô</span>
                            <span class="font-semibold text-sm">–í–µ—á–µ—Ä</span>
                            <span class="text-xs text-slate-500">18:00 - 22:00</span>
                        </button>
                        <button type="button" data-interval="–õ—é–±–æ–µ" class="flex flex-col items-center justify-center text-center p-3 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
                             <span class="text-2xl mb-1">üîÑ</span>
                            <span class="font-semibold text-sm">–õ—é–±–æ–µ</span>
                            <span class="text-xs text-slate-500">–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è</span>
                        </button>
                    </div>
                    <input type="hidden" name="time_interval" id="timeIntervalInput" required>
                    <div class="form-error-time text-red-500 text-xs text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</div>
                </div>
                <button type="submit" class="text-sm btn w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>
    </template>
    <template id="parcel-request-screen-template">
        <div class="p-5">
            <h2 class="text-lg font-bold mb-4">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</h2>
            <form id="parcel-request-form" class="space-y-4">
                 <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–û—Ç–∫—É–¥–∞</label>
                        <select name="from-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option></select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-600 mb-2">–ö—É–¥–∞</label>
                        <select name="to-select" class="w-full p-3 border border-slate-200 rounded-lg text-sm bg-white" required><option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option></select>
                    </div>
                </div>
                <input type="hidden" name="from" required><input type="hidden" name="to" required>
                <div class="form-error-direction text-red-500 text-xs text-center mt-2 hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç</div>
                <div><label for="date-parcel" class="block text-xs font-medium text-slate-600 mb-2">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</label><input type="date" name="ride_date" id="date-parcel" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required></div>
                <div id="parcel-price-info" class="bg-slate-100 p-3 rounded-lg text-center text-slate-600 text-sm">–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏: <span class="font-bold"></span> ‚ÇΩ</div>
                <button type="submit" class="text-sm btn w-full bg-purple-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-purple-700">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ—Å—ã–ª–∫—É</button>
            </form>
        </div>
    </template>
    <template id="admin-panel-screen-template">
        <div class="p-5">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: –ü–∞—Ä—Ç–Ω–µ—Ä—ã</h2>
                <button data-action="editPartner" class="text-sm btn bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div id="admin-partners-list" class="space-y-3">
                <!-- Partner list will be rendered here -->
            </div>
        </div>
    </template>
    <template id="admin-edit-partner-screen-template">
        <div class="p-5">
            <h2 id="admin-form-title" class="text-lg font-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h2>
            <form id="admin-partner-form" class="space-y-4">
                <input type="hidden" name="id">
                <div>
                    <label class="block text-xs font-medium text-slate-600 mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" name="title" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-600 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –≤–∏–¥–∂–µ—Ç–∞)</label>
                    <textarea name="description" class="w-full p-3 border border-slate-200 rounded-lg text-sm" rows="2"></textarea>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-600 mb-2">–°—Å—ã–ª–∫–∞ (URL)</label>
                    <input type="url" name="link_url" class="w-full p-3 border border-slate-200 rounded-lg text-sm" required>
                </div>
                <div class="p-3 bg-slate-50 rounded-lg border border-slate-200 flex items-center justify-between">
                    <label for="is_active_toggle" class="text-sm text-slate-700 font-medium cursor-pointer flex-grow">–ê–∫—Ç–∏–≤–µ–Ω</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="is_active_toggle" name="is_active" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>

                <h3 class="text-base font-bold pt-2">–°–ª–∞–π–¥—ã</h3>
                <div id="slides-editor" class="space-y-3">
                    <!-- Slide inputs will be rendered here -->
                </div>
                <button type="button" data-action="addSlide" class="text-sm btn w-full border border-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-100">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥</button>

                <div class="flex gap-4 pt-4">
                    <button type="submit" class="text-sm btn flex-1 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" data-action="deletePartner" id="delete-partner-btn" class="text-sm btn bg-red-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600 hidden">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </template>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const { createClient } = supabase;

        const App = {
            // --- CONFIGURATION ---
            config: {
                adminId: 5017229451,
                supabaseUrl: 'https://scqkpvmmoaolahpxinja.supabase.co',
                supabaseAnonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcWtwdm1tb2FvbGFocHhpbmphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDIwNDksImV4cCI6MjA3MTE3ODA0OX0.Uz5L2SF8O1EGf_efkq5FLi6g1yl7LlmnTZi_eLnISMw',
                prices: { base: 600, parcel: 300, cheboksary: 400, ferrySurcharge: 100 },
                cities: ['–ô–æ—à–∫–∞—Ä-–û–ª–∞', '–ß–µ–±–æ–∫—Å–∞—Ä—ã', '–ö–æ–∑—å–º–æ–¥–µ–º—å—è–Ω—Å–∫'],
            },
            
            // --- STATE ---
            state: {
                currentUser: null,
                userProfile: null,
                userRole: 'passenger',
                navigationHistory: ['passenger-home-screen'],
                allRequests: [],
                currentFilters: { from: '', to: '', date: '', type: 'all' },
                editingPartnerId: null,
            },
            
            // --- DOM ELEMENTS CACHE ---
            dom: {},

            // --- SUPABASE CLIENT ---
            supabase: null,
            
            // --- INITIALIZATION ---
            async init() {
                this.supabase = createClient(this.config.supabaseUrl, this.config.supabaseAnonKey);
                
                try {
                    Telegram.WebApp.ready();
                    Telegram.WebApp.expand();
                    this.state.currentUser = Telegram.WebApp.initDataUnsafe?.user;
                     if (!this.state.currentUser) {
                        throw new Error("Not in Telegram");
                    }
                    
                    this.ui.setAppHeight(); 
                    Telegram.WebApp.onEvent('viewportChanged', this.ui.setAppHeight);

                } catch (e) {
                    console.warn("–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º.");
                    this.state.currentUser = { id: 5017229451, first_name: 'Admin', username: 'testadmin', photo_url: null };
                }

                if (!this.state.currentUser?.id) {
                    document.body.innerHTML = '<div class="text-center p-8">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.</div>';
                    return;
                }
                
                await this.api.ensureUserProfile();
                this.cacheDom();
                this.bindEvents();
                this.ui.renderAllScreens();

                if (this.state.currentUser.id === this.config.adminId) {
                    document.getElementById('admin-plus-btn').classList.remove('hidden');
                }

                this.ui.updateRoleSwitcher();
                this.ui.updateAvatar();
            },

            cacheDom() {
                this.dom.backButton = document.getElementById('backButton');
                this.dom.mainContent = document.getElementById('main-content');
            },

            // --- API CALLS (Data Layer) ---
            api: {
                async ensureUserProfile() {
                    // ... (existing code, no changes needed)
                },
                async updateUserProfile(profileData) {
                    // ... (existing code, no changes needed)
                },
                async getPublicPartners() {
                    return await App.supabase
                        .from('partners')
                        .select(`*, partner_slides(*)`)
                        .eq('is_active', true)
                        .order('display_order', { referencedTable: 'partner_slides', ascending: true });
                },
                async getAllPartnersAdmin() {
                     return await App.supabase
                        .from('partners')
                        .select(`*, partner_slides(*)`)
                        .order('created_at', { ascending: false });
                },
                async getPartnerById(id) {
                    return await App.supabase
                        .from('partners')
                        .select(`*, partner_slides(*)`)
                        .eq('id', id)
                        .single();
                },
                async upsertPartner(partnerData) {
                    const { slides, ...partner } = partnerData;
                    
                    // Upsert Partner details
                    const { data: savedPartner, error: partnerError } = await App.supabase
                        .from('partners')
                        .upsert(partner)
                        .select()
                        .single();

                    if (partnerError) return { partnerError };

                    // Delete old slides for this partner
                    const { error: deleteError } = await App.supabase
                        .from('partner_slides')
                        .delete()
                        .eq('partner_id', savedPartner.id);
                    
                    if (deleteError) return { deleteError };

                    // Insert new slides
                    if (slides && slides.length > 0) {
                        const slidesToInsert = slides.map((slide, index) => ({
                            ...slide,
                            partner_id: savedPartner.id,
                            display_order: index
                        }));

                        const { error: slidesError } = await App.supabase
                            .from('partner_slides')
                            .insert(slidesToInsert);
                        
                        if (slidesError) return { slidesError };
                    }

                    return { data: savedPartner };
                },
                async deletePartner(partnerId) {
                    return await App.supabase
                        .from('partners')
                        .delete()
                        .eq('id', partnerId);
                }
            },

            // --- EVENT HANDLERS (Controller Layer) ---
            bindEvents() {
                // ... (add new handlers for admin actions)
                 document.body.addEventListener('click', (e) => {
                    const target = e.target;
                    const button = target.closest('button, [data-action]');
                    if (!button) return;

                    const { action, screen, ...dataset } = button.dataset;

                    const actions = {
                        // Navigation
                        navigateTo: () => this.navigation.to(screen),
                        back: () => this.navigation.back(),
                        backToHub: () => {
                            const hubScreen = this.state.userRole === 'driver' ? 'driver-dashboard-screen' : 'passenger-home-screen';
                            this.navigation.to(hubScreen, true);
                        },
                        // Main actions
                        switchRole: () => { /* ... existing ... */ },
                        viewDriverOffers: this.handlers.onViewDriverOffers,
                        viewPassengerRequests: this.handlers.onViewPassengerRequests,
                        myTrips: this.handlers.onMyTrips,
                        publishRide: () => { /* ... existing ... */ },
                        // List item actions
                        requestBooking: () => this.handlers.onRequestBooking(dataset.offerId),
                        detourBooking: () => this.ui.showBookingOptionsModal(JSON.parse(decodeURIComponent(dataset.offer))),
                        confirmBookingSegment: () => { /* ... existing ... */ },
                        cancelBooking: () => this.handlers.onCancelBooking(dataset.bookingId),
                        offerRide: () => this.handlers.onOfferRideToRequest(dataset.requestId, button),
                        updateBookingStatus: () => this.handlers.onUpdateBookingStatus(dataset.bookingId, dataset.status),
                        deleteOffer: () => this.handlers.onDeleteOffer(dataset.offerId),
                        cancelRequest: () => this.handlers.onCancelRequest(dataset.requestId),
                        cancelParcelRequest: () => this.handlers.onCancelParcelRequest(dataset.requestId),
                        // Modals & Filters
                        hideModal: this.ui.hideBookingModal,
                        toggleFilter: this.ui.toggleFilter,
                        applyFilters: this.handlers.onApplyFilters,
                        resetFilters: this.handlers.onResetFilters,

                        // --- ADMIN ACTIONS ---
                        editPartner: () => this.handlers.onEditPartner(dataset.partnerId),
                        addSlide: () => this.ui.addSlideInput(),
                        removeSlide: () => button.closest('.slide-input-group').remove(),
                        deletePartner: () => this.handlers.onDeletePartner(),
                    };

                    if (actions[action]) {
                        actions[action]();
                    } else if (target.closest('#time-interval-buttons')) {
                        this.handlers.onTimeSelect(button);
                    } else if (button.classList.contains('filter-type-btn')) {
                        this.handlers.onFilterTypeSelect(button);
                    }
                });

                document.body.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formHandlers = {
                        'profile-form': this.handlers.onProfileSubmit,
                        'offer-form': this.handlers.onOfferSubmit,
                        'passenger-request-form': this.handlers.onPassengerRequestSubmit,
                        'parcel-request-form': this.handlers.onParcelRequestSubmit,
                        'admin-partner-form': this.handlers.onSavePartner,
                    };
                    if (formHandlers[e.target.id]) formHandlers[e.target.id](e.target);
                });

                // ... (existing change listener)
            },

            // --- ACTION HANDLERS (Business Logic) ---
            handlers: {
                // ... (all existing handlers)

                // --- ADMIN HANDLERS ---
                async onEditPartner(partnerId = null) {
                    App.state.editingPartnerId = partnerId;
                    App.navigation.to('admin-edit-partner-screen');
                    if (partnerId) {
                        const { data, error } = await App.api.getPartnerById(partnerId);
                        if (error) {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞.');
                            return;
                        }
                        App.ui.renderAdminForm(data);
                    } else {
                        App.ui.renderAdminForm(); // Render empty form
                    }
                },
                async onSavePartner(form) {
                    const formData = new FormData(form);
                    const partnerData = {
                        id: App.state.editingPartnerId || undefined,
                        title: formData.get('title'),
                        description: formData.get('description'),
                        link_url: formData.get('link_url'),
                        is_active: form.querySelector('#is_active_toggle').checked,
                        slides: []
                    };

                    form.querySelectorAll('.slide-input-group').forEach(group => {
                        const image_url = group.querySelector('input[name="image_url"]').value;
                        const caption = group.querySelector('input[name="caption"]').value;
                        if (image_url) {
                            partnerData.slides.push({ image_url, caption });
                        }
                    });

                    const { error } = await App.api.upsertPartner(partnerData);
                    if (error) {
                        alert(`–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞: ${error.message}`);
                        return;
                    }
                    App.navigation.to('admin-panel-screen', true);
                },
                async onDeletePartner() {
                    if (!App.state.editingPartnerId || !confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞?')) {
                        return;
                    }
                    const { error } = await App.api.deletePartner(App.state.editingPartnerId);
                    if (error) {
                        alert(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞: ${error.message}`);
                        return;
                    }
                     App.navigation.to('admin-panel-screen', true);
                }
            },

            // --- NAVIGATION ---
            navigation: {
                to(screenId, resetHistory = false) {
                    // ... (existing code)
                    const isAdmin = App.state.currentUser.id === App.config.adminId;
                    const backButtonVisible = App.state.navigationHistory.length > 1;
                    App.dom.backButton.classList.toggle('invisible', !backButtonVisible);
                    
                    const adminButton = document.getElementById('admin-plus-btn');
                    if (adminButton) {
                        adminButton.classList.toggle('hidden', !isAdmin || backButtonVisible);
                    }

                    // Pre-population/rendering logic for new screens
                    if (screenId === 'admin-panel-screen') App.ui.renderAdminPanel();

                },
                back() { /* ... existing ... */ }
            },
            
            // --- UI & RENDER ---
            ui: {
                // ... (existing ui functions like setAppHeight, updateRoleSwitcher, updateAvatar, etc)
                renderAllScreens() {
                    const templates = document.querySelectorAll('template');
                    templates.forEach(template => {
                        const screenId = template.id.replace('-template', '');
                        const screen = document.getElementById(screenId);
                        if (screen) screen.innerHTML = template.innerHTML;
                    });
                    this.setDefaultDates();
                    this.populateSelects();
                    this.populatePartnerWidgets();
                    const offerPriceSpan = document.querySelector('#offer-form #publish-price');
                    if (offerPriceSpan) offerPriceSpan.textContent = App.config.prices.base;
                    const parcelPriceSpan = document.querySelector('#parcel-request-form #parcel-price-info span');
                    if(parcelPriceSpan) parcelPriceSpan.textContent = App.config.prices.parcel;
                },

                async populatePartnerWidgets() {
                    const { data, error } = await App.api.getPublicPartners();
                    if (error || !data || data.length === 0) {
                        console.warn('No active partners found or error fetching them.', error);
                        return;
                    }
                    
                    // Currently, we show the same (first) partner ad in all widget slots
                    const partner = data[0]; 
                    
                    document.querySelectorAll('.partner-widget-container').forEach(container => {
                        const widgetHTML = this.getPartnerWidgetHTML(partner);
                        container.innerHTML = widgetHTML;
                        const widgetEl = container.querySelector('.partner-widget');
                        if (widgetEl) this.initPartnerWidget(widgetEl);
                    });
                },
                getPartnerWidgetHTML(partner) {
                    if (!partner || !partner.partner_slides || partner.partner_slides.length === 0) return '';
                    const slidesHTML = partner.partner_slides.map(slide => `
                        <div class="slide">
                            <img src="${slide.image_url}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/64748b?text=Image+Error';" alt="${slide.caption || partner.title}" class="w-full h-48 object-cover">
                            <div class="slide-content">
                                <h4 class="font-bold">${partner.title}</h4>
                                <p class="text-xs mt-1 mb-2">${slide.caption || partner.description}</p>
                            </div>
                        </div>`).join('');

                    return `
                        <h3 class="text-base font-bold text-slate-800 mb-3 text-center">–ü–∞—Ä—Ç–Ω–µ—Ä—ã</h3>
                        <div class="partner-widget">
                            <div class="slider-container shadow-lg">
                                <div class="slider-track">${slidesHTML}</div>
                                <div class="slider-dots"></div>
                            </div>
                            <a href="${partner.link_url}" target="_blank" class="mt-3 text-sm btn w-full bg-blue-100 text-blue-800 font-bold py-2 px-4 rounded-xl hover:bg-blue-200 flex items-center justify-center gap-2">
                                –ü–µ—Ä–µ–π—Ç–∏
                            </a>
                        </div>`;
                },
                initPartnerWidget(widget) {
                     // ... (existing code, no changes needed)
                },
                
                // --- ADMIN UI ---
                async renderAdminPanel() {
                    const container = document.getElementById('admin-partners-list');
                    if (!container) return;
                    container.innerHTML = this.getLoaderHTML();

                    const { data, error } = await App.api.getAllPartnersAdmin();
                    if (error) {
                        container.innerHTML = this.getErrorHTML('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤.');
                        return;
                    }
                    if (!data.length) {
                        container.innerHTML = '<p class="text-center text-slate-500">–ü–∞—Ä—Ç–Ω–µ—Ä—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>';
                        return;
                    }

                    container.innerHTML = data.map(p => `
                        <div class="border rounded-lg p-3 flex justify-between items-center">
                            <div>
                                <p class="font-bold">${p.title}</p>
                                <p class="text-xs ${p.is_active ? 'text-green-600' : 'text-slate-500'}">${p.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</p>
                            </div>
                            <button data-action="editPartner" data-partner-id="${p.id}" class="text-sm btn bg-slate-100 text-slate-800 font-bold py-1 px-3 rounded-lg">–ò–∑–º.</button>
                        </div>
                    `).join('');
                },
                renderAdminForm(partner = {}) {
                    const form = document.getElementById('admin-partner-form');
                    const title = document.getElementById('admin-form-title');
                    const deleteBtn = document.getElementById('delete-partner-btn');
                    
                    title.textContent = partner.id ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞' : '–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞';
                    form.querySelector('[name="id"]').value = partner.id || '';
                    form.querySelector('[name="title"]').value = partner.title || '';
                    form.querySelector('[name="description"]').value = partner.description || '';
                    form.querySelector('[name="link_url"]').value = partner.link_url || '';
                    form.querySelector('#is_active_toggle').checked = partner.id ? partner.is_active : true;
                    
                    const slidesEditor = document.getElementById('slides-editor');
                    slidesEditor.innerHTML = '';
                    if(partner.partner_slides && partner.partner_slides.length > 0) {
                        partner.partner_slides.forEach(slide => this.addSlideInput(slide));
                    } else {
                        this.addSlideInput(); // Add one empty slide by default
                    }
                    
                    deleteBtn.classList.toggle('hidden', !partner.id);
                },
                addSlideInput(slide = {}) {
                    const container = document.getElementById('slides-editor');
                    const div = document.createElement('div');
                    div.className = 'slide-input-group border rounded-lg p-3 space-y-2 relative';
                    div.innerHTML = `
                        <input type="url" name="image_url" class="w-full p-2 border border-slate-200 rounded-lg text-sm" placeholder="URL –ö–∞—Ä—Ç–∏–Ω–∫–∏" value="${slide.image_url || ''}" required>
                        <input type="text" name="caption" class="w-full p-2 border border-slate-200 rounded-lg text-sm" placeholder="–ü–æ–¥–ø–∏—Å—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" value="${slide.caption || ''}">
                        <button type="button" data-action="removeSlide" class="absolute top-2 right-2 text-red-500 hover:text-red-700">&times;</button>
                    `;
                    container.appendChild(div);
                },

                // ... (rest of the existing UI functions)
            },

            // --- UTILS ---
            utils: {
                // ... (existing code)
            },
        };

        App.init();
    });
    </script>
</body>
</html>

